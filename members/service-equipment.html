<!DOCTYPE html>
<html lang="ja">
<head>
    <script>
        if(localStorage.getItem("member")!=="1"){
            location.href="index.html?next=service-equipment.html";
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»€å™¨å‚™å“é¸å®š | DEVELOPMENT Pro | TAmJ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #e63636;
            
            --primary-dark: #c41c1c;
            --white: #ffffff;
            --dark: #1d1d1d;
            --gray-text: #333333;
            --off-white: #ffffff;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --border: #e5e7eb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: "Inter", "Helvetica Neue", sans-serif;
            line-height: 1.6; 
            color: var(--dark);
            background: #ffffff;
        }
        a { text-decoration: none; color: inherit; }

        header {
            background: var(--white);
            padding: 0.8rem 1.5rem;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.05);
        }
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        .logo {
            font-family: "Bebas Neue", sans-serif;
            color: var(--primary);
            font-size: 1.6rem;
        }
        .logo .char-m { font-family: "Inter", sans-serif; font-weight: 300; font-size: 0.6em; }
        nav { display: flex; gap: 1.5rem; }
        nav a { color: var(--dark); font-size: 0.8rem; font-weight: 500; }
        nav a:hover { color: var(--primary); }

        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 6rem 1.5rem 2rem;
            margin-top: 50px;
            text-align: center;
        }
        .hero h1 { font-size: clamp(1.4rem, 3vw, 1.8rem); font-weight: 700; margin-bottom: 0.5rem; }
        .hero p { font-size: 0.9rem; opacity: 0.9; max-width: 650px; margin: 0 auto; }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
        }

        /* å…¥å±…è€…æ•°å…¥åŠ› */
        .bed-input-section {
            background: var(--white);
            border-radius: 14px;
            padding: 1.5rem 2rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .bed-input-section h3 {
            color: var(--dark);
            font-size: 1rem;
        }
        .bed-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        .bed-input {
            width: 100px;
            padding: 0.6rem 0.8rem;
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
            border: 2px solid var(--primary);
            border-radius: 10px;
            color: var(--dark);
        }
        .bed-input:focus {
            outline: none;
            border-color: var(--primary-dark);
        }
        .bed-unit {
            font-size: 1rem;
            color: var(--gray-text);
        }
        .preset-buttons {
            display: flex;
            gap: 0.4rem;
        }
        .preset-btn {
            padding: 0.4rem 0.8rem;
            border: 2px solid var(--primary);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        .preset-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* ãƒ¢ãƒ‡ãƒ«é¸æŠã‚¿ãƒ– */
        .model-tabs {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .model-tab {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            color: var(--dark);
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .model-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
        }
        .model-tab.active {
            background: var(--white);
            color: white;
        }
        .model-tab.entry.active { background: var(--primary); color: var(--dark); }
        .model-tab.middle.active { background: var(--primary); color: white; }
        .model-tab.highend.active { background: linear-gradient(135deg, var(--primary-dark), #be185d); color: white; }

        /* åˆè¨ˆé‡‘é¡è¡¨ç¤º */
        .total-display {
            background: var(--white);
            border-radius: 14px;
            padding: 1.5rem 2rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            text-align: center;
            position: sticky;
            top: 60px;
            z-index: 100;
            border: 2px solid var(--pale);
        }
        .total-display h2 {
            font-size: 1rem;
            color: var(--gray-text);
            margin-bottom: 0.3rem;
        }
        .total-amount {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary-dark);
        }
        .total-amount .tax {
            font-size: 0.85rem;
            color: var(--gray-text);
            font-weight: normal;
        }
        .total-breakdown {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 0.8rem;
            flex-wrap: wrap;
        }
        .breakdown-item {
            text-align: center;
        }
        .breakdown-item .label {
            font-size: 0.8rem;
            color: var(--gray-text);
        }
        .breakdown-item .value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }

        /* ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .category-section {
            background: white;
            border-radius: 14px;
            margin-bottom: 0.8rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            overflow: hidden;
        }
        .category-header {
            background: linear-gradient(135deg, #e63636, #c41c1c);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        .category-header:hover {
            background: linear-gradient(135deg, var(--primary-dark), #be185d);
        }
        .category-header-left {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        .category-checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--dark);
            cursor: pointer;
        }
        .category-header h3 {
            color: white;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }
        .category-header .icon {
            font-size: 1.2rem;
        }
        .category-total {
            font-size: 1rem;
            font-weight: 700;
            color: var(--dark);
            background: rgba(255,255,255,0.9);
            padding: 0.4rem 1rem;
            border-radius: 20px;
        }
        .category-toggle {
            font-size: 1.2rem;
            color: white;
            transition: transform 0.3s;
            margin-left: 0.8rem;
        }
        .category-section.collapsed .category-toggle {
            transform: rotate(-90deg);
        }
        .category-content {
            padding: 0;
            max-height: 5000px;
            overflow: hidden;
            transition: max-height 0.5s ease, padding 0.3s;
        }
        .category-section.collapsed .category-content {
            max-height: 0;
            padding: 0;
        }

        .subcategory {
            border-bottom: 1px solid var(--border);
        }
        .subcategory:last-child {
            border-bottom: none;
        }
        .subcategory-header {
            padding: 0.8rem 1.5rem;
            background: var(--off-white);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        .subcategory-total {
            color: var(--primary);
            font-weight: 700;
        }

        .item-row {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 0.8rem;
            padding: 0.7rem 1.5rem;
            align-items: center;
            border-bottom: 1px solid #f5f5f5;
            transition: background 0.2s, opacity 0.2s;
            font-size: 0.85rem;
        }
        .item-row:hover {
            background: var(--off-white);
        }
        .item-row:last-child {
            border-bottom: none;
        }
        .item-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }
        .item-name {
            color: var(--dark);
        }
        .item-qty {
            text-align: center;
            color: var(--gray-text);
            font-size: 0.8rem;
            min-width: 60px;
            background: #f5f5f5;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
        }
        .item-price {
            text-align: right;
            font-weight: 600;
            color: var(--dark);
            min-width: 100px;
        }
        .item-row.disabled {
            opacity: 0.4;
        }
        .item-row.disabled .item-price {
            text-decoration: line-through;
            color: #999;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .action-buttons {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        .action-btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .action-btn.primary {
            background: var(--primary);
            color: white;
        }
        .action-btn.primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.3);
        }
        .action-btn.secondary {
            background: white;
            color: var(--dark);
            border: 2px solid var(--dark);
        }
        .action-btn.secondary:hover {
            background: var(--white);
            color: white;
        }

        /* å‡¡ä¾‹ */
        .legend {
            background: white;
            border-radius: 14px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
        }
        .legend h4 {
            color: var(--dark);
            margin-bottom: 0.6rem;
            font-size: 0.9rem;
        }
        .legend-items {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.8rem;
        }
        .legend-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.75rem;
        }
        .legend-badge.entry { background: var(--pale); color: var(--primary-dark); }
        .legend-badge.middle { background: var(--primary); color: white; }
        .legend-badge.highend { background: linear-gradient(135deg, var(--primary-dark), #be185d); color: white; }

        footer {
            background: var(--white);
            color: white;
            padding: 2rem 1.5rem 1rem;
            margin-top: 3rem;
            text-align: center;
        }
        .footer-bottom {
            font-size: 0.8rem;
            color: var(--gray-text);
        }

        @media (max-width: 768px) {
            header { padding: 0.6rem 1rem; }
            .hero { padding: 5rem 1rem 1.5rem; }
            .hero h1 { font-size: 1.3rem; }
            .main-content { padding: 1rem 0.5rem; }
            .bed-input-section { flex-direction: column; gap: 0.8rem; padding: 1rem; }
            .model-tabs { gap: 0.4rem; }
            .model-tab { padding: 0.6rem 1.2rem; font-size: 0.85rem; }
            .total-display { padding: 1rem; }
            .total-amount { font-size: 1.6rem; }
            .category-header { padding: 0.8rem 1rem; flex-wrap: wrap; gap: 0.4rem; }
            .category-header h3 { font-size: 0.95rem; }
            .item-row {
                grid-template-columns: auto 1fr auto;
                gap: 0.4rem;
                padding: 0.6rem 0.8rem;
            }
            .item-qty { min-width: 50px; font-size: 0.75rem; }
            .item-price { min-width: 80px; font-size: 0.8rem; }
            nav { display: none; }
            .total-breakdown { gap: 1rem; }
        }

        @media print {
            header, .model-tabs, .action-buttons, footer, .bed-input-section, .legend { display: none; }
            .hero { padding: 1.5rem; margin-top: 0; }
            .category-section { break-inside: avoid; }
            .total-display { position: static; }
            .item-row.disabled { display: none; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <a href="../index.html" class="logo"><img src="../logo.png" alt="TAmJ" style="height: 28px;"></a>
            <nav>
                <a href="../home.html">ãƒ›ãƒ¼ãƒ </a>
                <a href="index.html">MEMBERS</a>
                <a href="service-development.html">é–‹ç™ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <h1>ğŸª‘ ä»€å™¨å‚™å“é¸å®š</h1>
        <p>æ–½è¨­ã®è¦æ¨¡ã‚„ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦ã€æœ€é©ãªè¨­å‚™ãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã„ãŸã—ã¾ã™</p>
    </section>

    <main class="main-content">
        <!-- å…¥å±…è€…æ•°å…¥åŠ› -->
        <div class="bed-input-section">
            <h3>ğŸ›ï¸ æ–½è¨­è¦æ¨¡ï¼ˆå…¥å±…è€…æ•°ï¼‰</h3>
            <div class="bed-input-wrapper">
                <input type="number" id="bedCount" class="bed-input" value="50" min="1" max="500" onchange="updateBedCount()">
                <span class="bed-unit">äºº</span>
            </div>
            <div class="preset-buttons">
                <button class="preset-btn" onclick="setBedCount(30)">30äºº</button>
                <button class="preset-btn" onclick="setBedCount(50)">50äºº</button>
                <button class="preset-btn" onclick="setBedCount(100)">100äºº</button>
                <button class="preset-btn" onclick="setBedCount(150)">150äºº</button>
            </div>
        </div>

        <!-- ãƒ¢ãƒ‡ãƒ«é¸æŠã‚¿ãƒ– -->
        <div class="model-tabs">
            <button class="model-tab entry active" onclick="selectModel('entry')">
                ğŸŒ± ã‚¨ãƒ³ãƒˆãƒªãƒ¼
            </button>
            <button class="model-tab middle" onclick="selectModel('middle')">
                â­ ãƒŸãƒ‰ãƒ«
            </button>
            <button class="model-tab highend" onclick="selectModel('highend')">
                ğŸ‘‘ ãƒã‚¤ã‚¨ãƒ³ãƒ‰
            </button>
        </div>

        <!-- å‡¡ä¾‹ -->
        <div class="legend">
            <h4>ã‚°ãƒ¬ãƒ¼ãƒ‰åˆ¥ä¾¡æ ¼ã«ã¤ã„ã¦</h4>
            <div class="legend-items">
                <div class="legend-item">
                    <span class="legend-badge entry">ã‚¨ãƒ³ãƒˆãƒªãƒ¼</span>
                    <span>ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆãŸåŸºæœ¬æ§‹æˆ</span>
                </div>
                <div class="legend-item">
                    <span class="legend-badge middle">ãƒŸãƒ‰ãƒ«</span>
                    <span>ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæ¨™æº–æ§‹æˆ</span>
                </div>
                <div class="legend-item">
                    <span class="legend-badge highend">ãƒã‚¤ã‚¨ãƒ³ãƒ‰</span>
                    <span>æœ€é«˜å“è³ªã®å……å®Ÿæ§‹æˆ</span>
                </div>
            </div>
        </div>

        <!-- åˆè¨ˆé‡‘é¡è¡¨ç¤º -->
        <div class="total-display">
            <h2>ãŠè¦‹ç©ã‚Šåˆè¨ˆé‡‘é¡ï¼ˆ<span id="displayBedCount">50</span>äººï¼‰</h2>
            <div class="total-amount">
                Â¥<span id="totalAmount">0</span>
                <span class="tax">ï¼ˆç¨è¾¼ï¼‰</span>
            </div>
            <div class="total-breakdown">
                <div class="breakdown-item">
                    <div class="label">ç¨æŠœé‡‘é¡</div>
                    <div class="value">Â¥<span id="subtotal">0</span></div>
                </div>
                <div class="breakdown-item">
                    <div class="label">æ¶ˆè²»ç¨(10%)</div>
                    <div class="value">Â¥<span id="taxAmount">0</span></div>
                </div>
                <div class="breakdown-item">
                    <div class="label">é¸æŠé …ç›®æ•°</div>
                    <div class="value"><span id="selectedCount">0</span> ä»¶</div>
                </div>
            </div>
        </div>

        <!-- ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="categories-container">
            <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
        </div>

        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
        <div class="action-buttons">
            <button class="action-btn secondary" onclick="resetAll()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
            <button class="action-btn secondary" onclick="selectAll()">âœ… å…¨ã¦é¸æŠ</button>
            <button class="action-btn primary" onclick="printEstimate()">ğŸ“„ è¦‹ç©æ›¸ã‚’å°åˆ·</button>
            <a href="service-development.html" class="action-btn secondary">â† ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«æˆ»ã‚‹</a>
        </div>
    </main>

    <footer>
        <div class="footer-bottom">
            <p>Â© 2024 TAmJ All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // å…¥å±…è€…æ•°
        let bedCount = 50;

        // è¦‹ç©ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const estimateData = {
            categories: [
                {
                    id: 'furniture',
                    name: 'å®¶å…·ãƒ»ä»€å™¨',
                    icon: 'ğŸª‘',
                    subcategories: [
                        {
                            name: 'ç„é–¢ãƒ»å…±ç”¨éƒ¨',
                            items: [
                                { name: 'å‚˜ç«‹ã¦', qtyType: 'fixed', baseQty: 1, entry: 21100, middle: 44850, highend: 89700 },
                                { name: 'ãƒ­ãƒ¼ãƒ—ãƒ«ã‚¹ãƒ„ãƒ¼ãƒ«ï¼ˆè‚˜ä»˜ãï¼‰', qtyType: 'fixed', baseQty: 2, entry: 24300, middle: 48600, highend: 97200 },
                                { name: '3äººæ›ã‘ã‚½ãƒ•ã‚¡', qtyType: 'fixed', baseQty: 1, entry: 72500, middle: 145145, highend: 290290 },
                                { name: '1äººæ›ã‘ã‚½ãƒ•ã‚¡', qtyType: 'perFloor', baseQty: 2, entry: 58500, middle: 117000, highend: 234000 },
                                { name: 'ãƒ­ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ¥•å††ï¼‰', qtyType: 'fixed', baseQty: 1, entry: 17950, middle: 35910, highend: 71820 },
                                { name: 'ãƒ­ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå††å½¢ï¼‰', qtyType: 'perFloor', baseQty: 1, entry: 13050, middle: 26100, highend: 52200 }
                            ]
                        },
                        {
                            name: 'äº‹å‹™å®¤',
                            items: [
                                { name: 'é›»å‹•æ˜‡é™ãƒ‡ã‚¹ã‚¯', qtyType: 'fixed', baseQty: 3, entry: 39375, middle: 78750, highend: 236250 },
                                { name: 'ãƒ¯ã‚´ãƒ³ï¼ˆ3æ®µï¼‰', qtyType: 'fixed', baseQty: 3, entry: 22680, middle: 68040, highend: 136080 },
                                { name: 'å›è»¢æ¤…å­', qtyType: 'ratio', baseQty: 0.1, entry: 17910, middle: 53730, highend: 161190 },
                                { name: 'ãƒ¯ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«', qtyType: 'fixed', baseQty: 3, entry: 53550, middle: 160650, highend: 321300 },
                                { name: 'ãƒã‚¤ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼', qtyType: 'fixed', baseQty: 1, entry: 17700, middle: 35415, highend: 70830 },
                                { name: 'ã‚­ãƒ£ãƒ“ãƒãƒƒãƒˆï¼ˆãƒ©ãƒ†ãƒ©ãƒ«3æ®µï¼‰', qtyType: 'fixed', baseQty: 3, entry: 51345, middle: 154035, highend: 308070 },
                                { name: 'ã‚­ãƒ£ãƒ“ãƒãƒƒãƒˆï¼ˆä¸¡é–‹ï¼‰', qtyType: 'fixed', baseQty: 4, entry: 26010, middle: 104040, highend: 208080 }
                            ]
                        },
                        {
                            name: 'ç›¸è«‡å®¤',
                            items: [
                                { name: 'ä¼šè­°ãƒ†ãƒ¼ãƒ–ãƒ«', qtyType: 'fixed', baseQty: 1, entry: 37800, middle: 75600, highend: 151200 },
                                { name: 'ãƒã‚§ã‚¢ï¼ˆè‚˜ãªã—ï¼‰', qtyType: 'fixed', baseQty: 6, entry: 28260, middle: 169560, highend: 339120 },
                                { name: 'ã‚­ãƒ£ãƒ“ãƒãƒƒãƒˆ', qtyType: 'fixed', baseQty: 1, entry: 27880, middle: 55760, highend: 111520 }
                            ]
                        },
                        {
                            name: 'å¥åº·ç®¡ç†å®¤',
                            items: [
                                { name: 'å¹³ãƒ‡ã‚¹ã‚¯', qtyType: 'fixed', baseQty: 2, entry: 19835, middle: 39669, highend: 79338 },
                                { name: 'ãƒ¯ã‚´ãƒ³', qtyType: 'fixed', baseQty: 2, entry: 16785, middle: 33570, highend: 67140 },
                                { name: 'ãƒ‰ã‚¯ã‚¿ãƒ¼ç”¨ãƒã‚§ã‚¢', qtyType: 'fixed', baseQty: 1, entry: 22005, middle: 44010, highend: 88020 },
                                { name: 'è¨ºå¯Ÿå°', qtyType: 'fixed', baseQty: 1, entry: 20150, middle: 40300, highend: 80600 },
                                { name: 'ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³', qtyType: 'fixed', baseQty: 1, entry: 8725, middle: 17450, highend: 34900 }
                            ]
                        },
                        {
                            name: 'ã‚¹ã‚¿ãƒƒãƒ•ä¼‘æ†©å®¤',
                            items: [
                                { name: 'ãƒ†ãƒ¼ãƒ–ãƒ«', qtyType: 'fixed', baseQty: 2, entry: 20205, middle: 40410, highend: 80820 },
                                { name: 'ãƒã‚§ã‚¢', qtyType: 'ratio', baseQty: 0.1, entry: 12960, middle: 25920, highend: 51840 },
                                { name: 'ã‚­ãƒƒãƒãƒ³ãƒœãƒ¼ãƒ‰', qtyType: 'fixed', baseQty: 1, entry: 14525, middle: 29250, highend: 58500 }
                            ]
                        },
                        {
                            name: 'æ›´è¡£å®¤',
                            items: [
                                { name: 'ãƒ­ãƒƒã‚«ãƒ¼', qtyType: 'ratio', baseQty: 0.15, entry: 40860, middle: 81720, highend: 163440 },
                                { name: 'ä¸¸ã‚¹ãƒ„ãƒ¼ãƒ«', qtyType: 'fixed', baseQty: 5, entry: 2790, middle: 13950, highend: 27900 },
                                { name: 'ãƒãƒ³ã‚¬ãƒ¼ãƒ©ãƒƒã‚¯', qtyType: 'fixed', baseQty: 2, entry: 13840, middle: 27680, highend: 55360 }
                            ]
                        },
                        {
                            name: 'ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒ»å…±ç”¨éƒ¨',
                            items: [
                                { name: 'ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«', qtyType: 'ratio', baseQty: 0.3, entry: 59400, middle: 118800, highend: 237600 },
                                { name: 'ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒã‚§ã‚¢ï¼ˆè‚˜ä»˜ãï¼‰', qtyType: 'perBed', baseQty: 1.2, entry: 23400, middle: 46800, highend: 93600 },
                                { name: 'ã‚½ãƒ•ã‚¡ï¼ˆ1äººç”¨ï¼‰', qtyType: 'perFloor', baseQty: 4, entry: 85500, middle: 171000, highend: 342000 },
                                { name: 'ã‚»ãƒ³ã‚¿ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«', qtyType: 'perFloor', baseQty: 3, entry: 28800, middle: 57600, highend: 115200 },
                                { name: 'ã‚­ãƒƒãƒãƒ³ãƒœãƒ¼ãƒ‰', qtyType: 'perFloor', baseQty: 2, entry: 40050, middle: 80100, highend: 160200 }
                            ]
                        },
                        {
                            name: 'å€‰åº«ãƒ»ãƒªãƒãƒ³åº«',
                            items: [
                                { name: 'ãƒ©ãƒƒã‚¯ï¼ˆå¤§ï¼‰', qtyType: 'perFloor', baseQty: 4, entry: 22770, middle: 45540, highend: 91080 },
                                { name: 'ãƒ©ãƒƒã‚¯ï¼ˆä¸­ï¼‰', qtyType: 'perFloor', baseQty: 6, entry: 18405, middle: 36810, highend: 73620 },
                                { name: 'ãƒ©ãƒƒã‚¯ï¼ˆå°ï¼‰', qtyType: 'perFloor', baseQty: 4, entry: 16065, middle: 32130, highend: 64260 }
                            ]
                        }
                    ]
                },
                {
                    id: 'kitchen',
                    name: 'å¨æˆ¿è¨­å‚™',
                    icon: 'ğŸ³',
                    subcategories: [
                        {
                            name: 'é£Ÿå“åº«',
                            items: [
                                { name: 'ã‚¿ãƒ†å‹å†·å‡å†·è”µåº«', qtyType: 'fixed', baseQty: 1, entry: 585500, middle: 1171000, highend: 1756500 },
                                { name: 'æ¤œé£Ÿç”¨ãƒ•ãƒªãƒ¼ã‚¶ãƒ¼', qtyType: 'fixed', baseQty: 1, entry: 224000, middle: 448000, highend: 672000 },
                                { name: 'ã‚·ã‚§ãƒ«ãƒ•', qtyType: 'fixed', baseQty: 3, entry: 48500, middle: 97000, highend: 194000 }
                            ]
                        },
                        {
                            name: 'ä¸‹å‡¦ç†',
                            items: [
                                { name: 'äºŒæ§½ã‚·ãƒ³ã‚¯', qtyType: 'fixed', baseQty: 1, entry: 49500, middle: 99000, highend: 148500 },
                                { name: 'ä½œæ¥­å°', qtyType: 'fixed', baseQty: 2, entry: 30500, middle: 61000, highend: 122000 },
                                { name: 'ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼å†·å‡åº«', qtyType: 'fixed', baseQty: 1, entry: 707000, middle: 1414000, highend: 2121000 },
                                { name: 'ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼å†·è”µåº«', qtyType: 'fixed', baseQty: 1, entry: 1024500, middle: 2049000, highend: 3073500 }
                            ]
                        },
                        {
                            name: 'å¨æˆ¿ï¼†é…è†³',
                            items: [
                                { name: 'ãƒ¨ã‚³å‹å†·è”µåº«', qtyType: 'fixed', baseQty: 3, entry: 389667, middle: 779333, highend: 1169000 },
                                { name: 'ãƒ–ãƒ©ã‚¹ãƒˆãƒãƒ©ãƒ¼', qtyType: 'fixed', baseQty: 1, entry: 900000, middle: 1800000, highend: 2700000 },
                                { name: 'IHç‚Šé£¯ã‚¸ãƒ£ãƒ¼', qtyType: 'fixed', baseQty: 3, entry: 85600, middle: 171200, highend: 342400 },
                                { name: 'ã‚¬ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«', qtyType: 'fixed', baseQty: 1, entry: 120000, middle: 240000, highend: 360000 },
                                { name: 'ã‚¹ãƒãƒ¼ãƒ ã‚³ãƒ³ãƒ™ã‚¯ã‚·ãƒ§ãƒ³ã‚ªãƒ¼ãƒ–ãƒ³', qtyType: 'fixed', baseQty: 1, entry: 1340000, middle: 2680000, highend: 4020000 },
                                { name: 'é…è†³è»Š', qtyType: 'ratio', baseQty: 0.04, entry: 1983500, middle: 3967000, highend: 5950500 },
                                { name: 'é©æ¸©é…è†³è»Š', qtyType: 'fixed', baseQty: 1, entry: 1450000, middle: 2900000, highend: 4350000 }
                            ]
                        },
                        {
                            name: 'æ´—æµ„',
                            items: [
                                { name: 'ã‚½ã‚¤ãƒ«ãƒ‰ã‚·ãƒ³ã‚¯', qtyType: 'fixed', baseQty: 1, entry: 140000, middle: 280000, highend: 420000 },
                                { name: 'é£Ÿå™¨æ´—æµ„æ©Ÿ', qtyType: 'fixed', baseQty: 1, entry: 710000, middle: 1420000, highend: 2130000 },
                                { name: 'é£Ÿå™¨æ¶ˆæ¯’ä¿ç®¡åº«', qtyType: 'fixed', baseQty: 1, entry: 470000, middle: 940000, highend: 1410000 }
                            ]
                        }
                    ]
                },
                {
                    id: 'general',
                    name: 'ä¸€èˆ¬å‚™å“',
                    icon: 'ğŸ§¹',
                    subcategories: [
                        {
                            name: 'ç”Ÿæ´»å‚™å“',
                            items: [
                                { name: 'ä½“é‡è¨ˆ', qtyType: 'perFloor', baseQty: 1, entry: 1150, middle: 2300, highend: 4600 },
                                { name: 'å®¤æ¸©è¨ˆ', qtyType: 'perFloor', baseQty: 2, entry: 900, middle: 1800, highend: 3600 },
                                { name: 'ãƒ‰ãƒ©ã‚¤ãƒ¤ãƒ¼', qtyType: 'perFloor', baseQty: 2, entry: 1000, middle: 2000, highend: 4000 },
                                { name: 'ã‚³ãƒ¼ãƒ‰ãƒ¬ã‚¹æƒé™¤æ©Ÿ', qtyType: 'perFloor', baseQty: 2, entry: 5950, middle: 11900, highend: 23800 }
                            ]
                        },
                        {
                            name: 'æ¬å…¥è¨­ç½®è²»',
                            items: [
                                { name: 'æ¬å…¥è¨­ç½®è²»ä¸€å¼', qtyType: 'fixed', baseQty: 1, entry: 100000, middle: 200000, highend: 400000 }
                            ]
                        }
                    ]
                },
                {
                    id: 'medical',
                    name: 'åŒ»ç™‚ãƒ»ä»‹è­·ç”¨å“',
                    icon: 'ğŸ¥',
                    subcategories: [
                        {
                            name: 'æ¸¬å®šæ©Ÿå™¨',
                            items: [
                                { name: 'è´è¨ºå™¨', qtyType: 'perFloor', baseQty: 2, entry: 822, middle: 1644, highend: 3288 },
                                { name: 'æ‰‹é¦–è¡€åœ§è¨ˆ', qtyType: 'perFloor', baseQty: 2, entry: 2092, middle: 4184, highend: 8368 },
                                { name: 'éæ¥è§¦ä½“æ¸©è¨ˆ', qtyType: 'perFloor', baseQty: 2, entry: 3300, middle: 6600, highend: 13200 },
                                { name: 'ãƒ‘ãƒ«ã‚¹ã‚ªã‚­ã‚·ãƒ¡ãƒ¼ã‚¿ãƒ¼', qtyType: 'perFloor', baseQty: 2, entry: 9770, middle: 19540, highend: 39080 }
                            ]
                        },
                        {
                            name: 'å›è¨ºè»Šãƒ»ã‚«ãƒ¼ãƒˆ',
                            items: [
                                { name: 'å›è¨ºè»Š', qtyType: 'perFloor', baseQty: 1, entry: 29885, middle: 59770, highend: 119540 },
                                { name: 'ãƒŠãƒ¼ã‚·ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ', qtyType: 'perFloor', baseQty: 1, entry: 32874, middle: 65747, highend: 131494 },
                                { name: 'ãƒŸãƒ‹ãƒ¯ã‚´ãƒ³', qtyType: 'perFloor', baseQty: 1, entry: 11207, middle: 22414, highend: 44828 }
                            ]
                        },
                        {
                            name: 'æ•‘æ€¥ç”¨å“',
                            items: [
                                { name: 'æ•‘æ€¥è˜‡ç”Ÿã‚±ãƒ¼ã‚¹', qtyType: 'perFloor', baseQty: 2, entry: 15690, middle: 31379, highend: 62758 }
                            ]
                        }
                    ]
                },
                {
                    id: 'bath',
                    name: 'ç‰¹æ®Šæµ´æ§½è¨­å‚™',
                    icon: 'ğŸ›',
                    subcategories: [
                        {
                            name: 'ç‰¹æ®Šæµ´æ§½',
                            items: [
                                { name: 'ã‚¨ãƒ¬ãƒ™ãƒ¼ãƒˆãƒã‚¹', qtyType: 'fixed', baseQty: 1, entry: 1089000, middle: 2178000, highend: 3267000 },
                                { name: 'æ°—æ³¡æµ´è£…ç½®', qtyType: 'fixed', baseQty: 1, entry: 60500, middle: 121000, highend: 181500 },
                                { name: 'æ‹…æ¶', qtyType: 'fixed', baseQty: 1, entry: 231000, middle: 462000, highend: 693000 },
                                { name: 'ã‚¹ãƒˆãƒ¬ãƒƒãƒãƒ£ãƒ¼', qtyType: 'fixed', baseQty: 1, entry: 396000, middle: 792000, highend: 1188000 }
                            ]
                        },
                        {
                            name: 'ãƒŸã‚¹ãƒˆæµ´',
                            items: [
                                { name: 'ã‚·ãƒ£ãƒ¯ãƒ¼å…¥æµ´è£…ç½®', qtyType: 'fixed', baseQty: 1, entry: 1825000, middle: 3650000, highend: 5475000 },
                                { name: 'ã‚¹ãƒˆãƒ¬ãƒƒãƒãƒ£ãƒ¼', qtyType: 'fixed', baseQty: 1, entry: 1020000, middle: 2040000, highend: 3060000 }
                            ]
                        },
                        {
                            name: 'æ¬å…¥è¨­ç½®è²»',
                            items: [
                                { name: 'å–ä»˜ãƒ»é‹é€ãƒ»è¨­ç½®è²»', qtyType: 'fixed', baseQty: 1, entry: 164000, middle: 328000, highend: 656000 }
                            ]
                        }
                    ]
                },
                {
                    id: 'it',
                    name: 'ITãƒ»é€šä¿¡è¨­å‚™',
                    icon: 'ğŸ’»',
                    subcategories: [
                        {
                            name: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨',
                            items: [
                                { name: 'L3ã‚¹ã‚¤ãƒƒãƒ', qtyType: 'fixed', baseQty: 1, entry: 396000, middle: 792000, highend: 1188000 },
                                { name: 'L2ã‚¹ã‚¤ãƒƒãƒï¼ˆå„éšï¼‰', qtyType: 'perFloor', baseQty: 2, entry: 218400, middle: 436800, highend: 873600 },
                                { name: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å°å…¥æ”¯æ´', qtyType: 'fixed', baseQty: 1, entry: 250000, middle: 500000, highend: 750000 }
                            ]
                        },
                        {
                            name: 'Wi-Fiè¨­å‚™',
                            items: [
                                { name: 'Wi-Fiã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆ', qtyType: 'perBed', baseQty: 1.5, entry: 46750, middle: 93500, highend: 187000 },
                                { name: 'Wi-Fiå°å…¥æ”¯æ´', qtyType: 'fixed', baseQty: 1, entry: 50000, middle: 100000, highend: 150000 }
                            ]
                        },
                        {
                            name: 'LANé…ç·šå·¥äº‹',
                            items: [
                                { name: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å·¥äº‹ä¸€å¼', qtyType: 'ratio', baseQty: 35, entry: 1744900, middle: 3489800, highend: 5234700 }
                            ]
                        }
                    ]
                },
                {
                    id: 'monitoring',
                    name: 'è¦‹å®ˆã‚Šãƒ»ä»‹è­·ã‚·ã‚¹ãƒ†ãƒ ',
                    icon: 'ğŸ‘ï¸',
                    subcategories: [
                        {
                            name: 'å±…å®¤å†…',
                            items: [
                                { name: 'ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤', qtyType: 'perBed', baseQty: 1, entry: 35153, middle: 70305, highend: 140610 },
                                { name: 'å‘¼ã³å‡ºã—ãƒœã‚¿ãƒ³ï¼ˆå±…å®¤ç”¨ï¼‰', qtyType: 'perBed', baseQty: 1, entry: 9875, middle: 19750, highend: 39500 },
                                { name: 'å‘¼ã³å‡ºã—ãƒœã‚¿ãƒ³ï¼ˆãƒˆã‚¤ãƒ¬ç”¨ï¼‰', qtyType: 'perBed', baseQty: 1, entry: 9875, middle: 19750, highend: 39500 }
                            ]
                        },
                        {
                            name: 'å…±ç”¨éƒ¨',
                            items: [
                                { name: 'å…±ç”¨éƒ¨ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤', qtyType: 'ratio', baseQty: 0.4, entry: 15413, middle: 30825, highend: 61650 },
                                { name: 'å‘¼ã³å‡ºã—ãƒœã‚¿ãƒ³ï¼ˆå…±ç”¨éƒ¨ï¼‰', qtyType: 'ratio', baseQty: 0.6, entry: 9875, middle: 19750, highend: 39500 }
                            ]
                        },
                        {
                            name: 'ã‚·ã‚¹ãƒ†ãƒ è²»',
                            items: [
                                { name: 'ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è²»', qtyType: 'fixed', baseQty: 1, entry: 250000, middle: 500000, highend: 750000 },
                                { name: 'å°å…¥æ”¯æ´è²»', qtyType: 'fixed', baseQty: 1, entry: 250000, middle: 500000, highend: 750000 },
                                { name: 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå°å…¥æ”¯æ´', qtyType: 'fixed', baseQty: 1, entry: 1200000, middle: 2400000, highend: 3600000 }
                            ]
                        }
                    ]
                },
                {
                    id: 'carerecord',
                    name: 'ä»‹è­·è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ',
                    icon: 'ğŸ“‹',
                    subcategories: [
                        {
                            name: 'ã‚¯ãƒ©ã‚¦ãƒ‰å‹ï¼ˆ5å¹´æ›ç®—ï¼‰',
                            items: [
                                { name: 'ã‚«ã‚¤ãƒã‚±ï¼ˆè¨ªå•ä»‹è­·/éšœå®³ï¼‰', qtyType: 'fixed', baseQty: 1, entry: 1500000, middle: 1500000, highend: 1500000 },
                                { name: 'ã‚«ã‚¤ãƒã‚±ï¼ˆä¸Šè¨˜ä»¥å¤–ï¼‰', qtyType: 'fixed', baseQty: 1, entry: 300000, middle: 300000, highend: 300000 },
                                { name: 'ã‚«ãƒŠãƒŸãƒƒã‚¯', qtyType: 'fixed', baseQty: 1, entry: 1900000, middle: 2200000, highend: 2500000 },
                                { name: 'ãƒ¯ã‚¤ã‚ºãƒãƒ³ ã‚»ã‚«ãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³', qtyType: 'fixed', baseQty: 1, entry: 99000, middle: 150000, highend: 300000 }
                            ]
                        }
                    ]
                },
                {
                    id: 'curtain',
                    name: 'ã‚«ãƒ¼ãƒ†ãƒ³ä¸€å¼',
                    icon: 'ğŸªŸ',
                    subcategories: [
                        {
                            name: 'ã‚«ãƒ¼ãƒ†ãƒ³',
                            items: [
                                { name: 'ã‚«ãƒ¼ãƒ†ãƒ³ãƒ»ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ææ–™è²»', qtyType: 'perBed', baseQty: 1, entry: 10136, middle: 20272, highend: 40544 },
                                { name: 'æ–½å·¥å–ä»˜å·¥äº‹è²»', qtyType: 'fixed', baseQty: 1, entry: 172750, middle: 345500, highend: 691000 }
                            ]
                        }
                    ]
                }
            ]
        };

        // ç¾åœ¨ã®ãƒ¢ãƒ‡ãƒ«
        let currentModel = 'entry';

        // ã‚«ãƒ†ã‚´ãƒªã®é–‹é–‰çŠ¶æ…‹
        const categoryStates = {};
        estimateData.categories.forEach(cat => {
            categoryStates[cat.id] = true;
        });

        // ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹
        const itemChecked = {};

        // åˆæœŸåŒ–
        function init() {
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å…¥å±…è€…æ•°ã‚’å–å¾—
            const params = new URLSearchParams(window.location.search);
            if(params.has('residents')) {
                bedCount = parseInt(params.get('residents')) || 50;
                document.getElementById('bedCount').value = bedCount;
            }
            
            estimateData.categories.forEach(category => {
                category.subcategories.forEach((sub, subIdx) => {
                    sub.items.forEach((item, itemIdx) => {
                        itemChecked[getItemKey(category.id, subIdx, itemIdx)] = true;
                    });
                });
            });
            renderCategories();
            updateTotals();
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ã‚­ãƒ¼ã‚’ç”Ÿæˆ
        function getItemKey(categoryId, subIdx, itemIdx) {
            return `${categoryId}-${subIdx}-${itemIdx}`;
        }

        // æ•°é‡ã‚’è¨ˆç®—
        function calculateQty(item) {
            const floors = Math.ceil(bedCount / 30);
            switch(item.qtyType) {
                case 'fixed': return item.baseQty;
                case 'perBed': return Math.ceil(bedCount * item.baseQty);
                case 'perFloor': return item.baseQty * floors;
                case 'ratio': return Math.ceil(bedCount * item.baseQty);
                default: return item.baseQty;
            }
        }

        // å…¥å±…è€…æ•°ã‚’æ›´æ–°
        function updateBedCount() {
            bedCount = parseInt(document.getElementById('bedCount').value) || 50;
            document.getElementById('displayBedCount').textContent = bedCount;
            renderCategories();
            updateTotals();
        }

        // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
        function setBedCount(count) {
            bedCount = count;
            document.getElementById('bedCount').value = count;
            document.getElementById('displayBedCount').textContent = count;
            renderCategories();
            updateTotals();
        }

        // ã‚«ãƒ†ã‚´ãƒªå…¨ã¦ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹
        function isCategoryFullyChecked(category) {
            for (let subIdx = 0; subIdx < category.subcategories.length; subIdx++) {
                for (let itemIdx = 0; itemIdx < category.subcategories[subIdx].items.length; itemIdx++) {
                    if (!itemChecked[getItemKey(category.id, subIdx, itemIdx)]) {
                        return false;
                    }
                }
            }
            return true;
        }

        // ã‚«ãƒ†ã‚´ãƒªã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderCategories() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';

            estimateData.categories.forEach(category => {
                const isCollapsed = !categoryStates[category.id];
                const isFullyChecked = isCategoryFullyChecked(category);
                const categoryTotal = calculateCategoryTotal(category);

                let categoryHTML = `
                    <div class="category-section ${isCollapsed ? 'collapsed' : ''}" id="category-${category.id}">
                        <div class="category-header">
                            <div class="category-header-left">
                                <input type="checkbox" class="category-checkbox" 
                                    ${isFullyChecked ? 'checked' : ''} 
                                    onclick="event.stopPropagation(); toggleCategoryCheck('${category.id}')">
                                <h3 onclick="toggleCategoryCollapse('${category.id}')">
                                    <span class="icon">${category.icon}</span>${category.name}
                                </h3>
                            </div>
                            <span class="category-total">Â¥${formatNumber(categoryTotal)}</span>
                            <span class="category-toggle" onclick="toggleCategoryCollapse('${category.id}')">â–¼</span>
                        </div>
                        <div class="category-content">
                `;

                category.subcategories.forEach((subcategory, subIdx) => {
                    const subTotal = calculateSubcategoryTotal(category, subIdx);
                    categoryHTML += `
                        <div class="subcategory">
                            <div class="subcategory-header">
                                <span>${subcategory.name}</span>
                                <span class="subcategory-total">Â¥${formatNumber(subTotal)}</span>
                            </div>
                    `;

                    subcategory.items.forEach((item, itemIdx) => {
                        const key = getItemKey(category.id, subIdx, itemIdx);
                        const isChecked = itemChecked[key];
                        const qty = calculateQty(item);
                        const price = item[currentModel] * qty;

                        categoryHTML += `
                            <div class="item-row ${isChecked ? '' : 'disabled'}">
                                <input type="checkbox" class="item-checkbox" 
                                    ${isChecked ? 'checked' : ''} 
                                    onchange="toggleItem('${key}')">
                                <div class="item-name">${item.name}</div>
                                <div class="item-qty">${qty}ç‚¹</div>
                                <div class="item-price">Â¥${formatNumber(price)}</div>
                            </div>
                        `;
                    });

                    categoryHTML += `</div>`;
                });

                categoryHTML += `</div></div>`;
                container.innerHTML += categoryHTML;
            });
        }

        // ã‚«ãƒ†ã‚´ãƒªã®ãƒã‚§ãƒƒã‚¯ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleCategoryCheck(categoryId) {
            const category = estimateData.categories.find(c => c.id === categoryId);
            const isFullyChecked = isCategoryFullyChecked(category);
            const newState = !isFullyChecked;

            category.subcategories.forEach((sub, subIdx) => {
                sub.items.forEach((item, itemIdx) => {
                    itemChecked[getItemKey(categoryId, subIdx, itemIdx)] = newState;
                });
            });

            renderCategories();
            updateTotals();
        }

        // å€‹åˆ¥ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒã‚§ãƒƒã‚¯ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleItem(key) {
            itemChecked[key] = !itemChecked[key];
            renderCategories();
            updateTotals();
        }

        // ã‚«ãƒ†ã‚´ãƒªã®é–‹é–‰ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleCategoryCollapse(categoryId) {
            categoryStates[categoryId] = !categoryStates[categoryId];
            const element = document.getElementById(`category-${categoryId}`);
            element.classList.toggle('collapsed');
        }

        // ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠ
        function selectModel(model) {
            currentModel = model;
            document.querySelectorAll('.model-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.model-tab.${model}`).classList.add('active');
            renderCategories();
            updateTotals();
        }

        // ã‚«ãƒ†ã‚´ãƒªã®åˆè¨ˆã‚’è¨ˆç®—
        function calculateCategoryTotal(category) {
            let total = 0;
            category.subcategories.forEach((sub, subIdx) => {
                sub.items.forEach((item, itemIdx) => {
                    const key = getItemKey(category.id, subIdx, itemIdx);
                    if (itemChecked[key]) {
                        const qty = calculateQty(item);
                        total += item[currentModel] * qty;
                    }
                });
            });
            return total;
        }

        // ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªã®åˆè¨ˆã‚’è¨ˆç®—
        function calculateSubcategoryTotal(category, subIdx) {
            let total = 0;
            category.subcategories[subIdx].items.forEach((item, itemIdx) => {
                const key = getItemKey(category.id, subIdx, itemIdx);
                if (itemChecked[key]) {
                    const qty = calculateQty(item);
                    total += item[currentModel] * qty;
                }
            });
            return total;
        }

        // åˆè¨ˆã‚’æ›´æ–°
        function updateTotals() {
            let subtotal = 0;
            let selectedCount = 0;

            estimateData.categories.forEach(cat => {
                cat.subcategories.forEach((sub, subIdx) => {
                    sub.items.forEach((item, itemIdx) => {
                        const key = getItemKey(cat.id, subIdx, itemIdx);
                        if (itemChecked[key]) {
                            const qty = calculateQty(item);
                            subtotal += item[currentModel] * qty;
                            selectedCount++;
                        }
                    });
                });
            });

            const tax = Math.floor(subtotal * 0.1);
            const total = subtotal + tax;

            document.getElementById('totalAmount').textContent = formatNumber(total);
            document.getElementById('subtotal').textContent = formatNumber(subtotal);
            document.getElementById('taxAmount').textContent = formatNumber(tax);
            document.getElementById('selectedCount').textContent = selectedCount;
        }

        // æ•°å­—ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatNumber(num) {
            return Math.round(num).toLocaleString('ja-JP');
        }

        // å…¨ã¦ãƒªã‚»ãƒƒãƒˆ
        function resetAll() {
            Object.keys(itemChecked).forEach(key => {
                itemChecked[key] = false;
            });
            renderCategories();
            updateTotals();
        }

        // å…¨ã¦é¸æŠ
        function selectAll() {
            Object.keys(itemChecked).forEach(key => {
                itemChecked[key] = true;
            });
            renderCategories();
            updateTotals();
        }

        // å°åˆ·
        function printEstimate() {
            window.print();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
