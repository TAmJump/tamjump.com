<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é–‹ç™ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | DEVELOPMENT Pro | TAmJ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #E60012;
            
            --primary-dark: #C5000F;
            --white: #ffffff;
            --dark: #1d1d1d;
            --gray-text: #333333;
            --off-white: #ffffff;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --border: #e5e7eb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: "Inter", "Helvetica Neue", sans-serif;
            line-height: 1.6; 
            color: var(--dark);
            background: #ffffff;
        }
        a { text-decoration: none; color: inherit; }

        header {
            background: var(--white);
            padding: 0.8rem 1.5rem;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.05);
        }
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        .logo {
            font-family: "Bebas Neue", sans-serif;
            color: var(--primary);
            font-size: 1.6rem;
        }
        .logo .char-m { font-family: "Inter", sans-serif; font-weight: 300; font-size: 0.6em; }
        nav { display: flex; gap: 1.5rem; }
        nav a { color: var(--dark); font-size: 0.8rem; font-weight: 500; }
        nav a:hover { color: var(--primary); }

        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 6rem 1.5rem 2rem;
            margin-top: 50px;
            text-align: center;
        }
        .hero h1 { font-size: clamp(1.2rem, 3vw, 1.6rem); font-weight: 700; margin-bottom: 0.5rem; }
        .hero p { font-size: 0.85rem; opacity: 0.9; max-width: 650px; margin: 0 auto; }
        .flow { display: flex; gap: 0.4rem; flex-wrap: wrap; justify-content: center; margin-top: 1rem; }
        .flow .step { background: rgba(255,255,255,0.15); padding: 0.3rem 0.7rem; border-radius: 50px; font-size: 0.75rem; }

        .wrap { max-width: 1180px; margin: 0 auto; padding: 1rem; }
        .grid { display: grid; grid-template-columns: 1.15fr 0.85fr; gap: 1rem; margin-top: 0.8rem; align-items: start; }
        @media (max-width: 1024px) { .grid { grid-template-columns: 1fr; } }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.2rem;
            margin-bottom: 0.8rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.02);
        }
        .sectionTitle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.8rem;
        }
        .sectionTitle h2 {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .sectionTitle h2 .num {
            width: 22px; height: 22px;
            background: linear-gradient(135deg, #E60012, #C5000F);
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            color: var(--white);
            font-size: 0.7rem;
        }
        .badge {
            padding: 0.15rem 0.5rem;
            border-radius: 50px;
            border: 1px solid var(--border);
            font-size: 0.6rem;
            color: var(--gray-text);
            background: var(--off-white);
        }

        .row { display: flex; gap: 0.6rem; flex-wrap: wrap; align-items: flex-end; }
        label {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            color: var(--gray-text);
            font-size: 0.65rem;
            font-weight: 500;
            min-width: 130px;
        }
        input, select {
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.55rem 0.7rem;
            color: var(--dark);
            font-size: 0.8rem;
            min-width: 130px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(230, 0, 18, 0.1);
        }
        input[type="number"] { width: 130px; }
        input:disabled { background: #f3f4f6; opacity: 0.7; }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.35rem 0.6rem;
            border: 1px solid var(--border);
            border-radius: 50px;
            font-size: 0.7rem;
            color: var(--gray-text);
            background: var(--white);
        }
        .pill b { color: var(--dark); }
        .pill.highlight { background: var(--off-white); border-color: var(--primary); }
        .pill.highlight b { color: var(--primary); }

        .hint { color: var(--gray-text); font-size: 0.62rem; margin-top: 0.5rem; line-height: 1.4; }
        .hr { height: 1px; background: var(--border); margin: 0.8rem 0; }

        .tasks { display: grid; gap: 0.4rem; margin-top: 0.5rem; }
        .task {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 0.5rem;
            padding: 0.5rem 0.7rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--input-bg);
        }
        .task:hover { border-color: var(--primary); background: var(--off-white); }
        .task .left { display: flex; align-items: flex-start; gap: 0.5rem; }
        .task input[type="checkbox"] { width: 15px; height: 15px; margin-top: 2px; accent-color: var(--primary); }
        .task .name { font-size: 0.8rem; font-weight: 600; }
        .task .desc { font-size: 0.65rem; color: var(--gray-text); }
        .task .range { text-align: right; min-width: 100px; }
        .task .range strong { font-size: 0.75rem; color: var(--primary); }
        .task .range span { font-size: 0.6rem; color: var(--gray-text); }

        .phaseTitle {
            font-size: 0.8rem;
            font-weight: 700;
            margin: 0.7rem 0 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        .phaseTitle .id {
            width: 18px; height: 18px;
            background: var(--primary);
            border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            color: var(--white);
            font-size: 0.65rem;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
        th, td { border-bottom: 1px solid var(--border); padding: 0.45rem 0.3rem; font-size: 0.7rem; }
        th { text-align: left; color: var(--gray-text); font-weight: 600; }
        td.num { text-align: right; font-weight: 500; }

        .total {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            padding: 0.7rem 0.9rem;
            border: 2px solid var(--primary);
            border-radius: 10px;
            background: var(--off-white);
            margin-top: 0.7rem;
        }
        .total strong { font-size: 1.1rem; color: var(--primary); }
        .total .small { font-size: 0.6rem; color: var(--gray-text); }

        .yield-box {
            background: linear-gradient(135deg, #E60012, #C5000F);
            color: var(--white);
            padding: 0.7rem;
            border-radius: 10px;
            text-align: center;
            margin: 0.7rem 0;
        }
        .yield-box .label { font-size: 0.65rem; opacity: 0.9; }
        .yield-box .value { font-size: 1.5rem; font-weight: 700; }
        .yield-row { display: flex; justify-content: space-around; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid rgba(255,255,255,0.2); }
        .yield-row .label { font-size: 0.55rem; }
        .yield-row .value { font-size: 0.9rem; }

        .cta { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.7rem; }
        .btn {
            cursor: pointer;
            border: none;
            border-radius: 50px;
            padding: 0.6rem 1rem;
            font-weight: 600;
            font-size: 0.8rem;
        }
        .btn.primary { background: linear-gradient(135deg, #E60012, #C5000F); color: white; }
        .btn.primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(230, 0, 18, 0.3); }
        .btn.secondary { background: var(--white); border: 2px solid var(--primary); color: var(--primary); }

        .summary-sidebar { position: sticky; top: 70px; }

        .summary-card {
            background: var(--white);
            border-radius: 14px;
            padding: 1rem;
            box-shadow: 0 8px 30px rgba(230, 0, 18, 0.1);
            border: 2px solid var(--primary);
        }
        .summary-card h3 { font-size: 0.9rem; font-weight: 700; margin-bottom: 0.6rem; }

        footer {
            background: var(--white);
            color: var(--white);
            padding: 1.2rem;
            text-align: center;
            margin-top: 1.5rem;
        }
        .footer-logo { font-family: "Bebas Neue", sans-serif; font-size: 1.2rem; }
        .footer-copy { font-size: 0.65rem; color: rgba(255, 255, 255, 0.5); }

        @media (max-width: 768px) {
            header { padding: 0.6rem 0.8rem; }
            nav { display: none; }
            .hero { padding: 4.5rem 1rem 1.5rem; }
            .wrap { padding: 0.8rem; }
            input, select { min-width: 100%; }
            .task { flex-direction: column; }
            .task .range { text-align: left; }
        }
        @media print {
            header, footer, .cta { display: none; }
            .grid { display: block; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <a href="home.html" class="logo"><img src="logo.png" alt="TAmJ" style="height: 28px;"></a>
            <nav>
                <a href="home.html">HOME</a>
                <a href="services.html">SOLUTION</a>
                <a href="about-company.html">ABOUT</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <h1>ä»‹è­·ãƒ»åŒ»ç™‚æ–½è¨­ã®é–‹ç™ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
        <p><strong>æ–½è¨­ç¨®åˆ¥ï¼‹å…¥å±…è€…æ•°</strong>ã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã§ã€é¢ç©â†’å»ºç¯‰è²»â†’æŠ•è³‡é¡ã‚’è‡ªå‹•ã§æ¦‚ç®—ã—ã¾ã™ã€‚</p>
        <div class="flow" id="flow"></div>
    </section>

    <div class="wrap">
        <div class="grid">
            <div>
                <!-- 0. æ–½è¨­ç¨®åˆ¥ -->
                <div class="card">
                    <div class="sectionTitle">
                        <h2><span class="num">0</span> æ–½è¨­ç¨®åˆ¥ï¼‹ã‹ã‚“ãŸã‚“å…¥åŠ›</h2>
                        <span class="badge">ä¿‚æ•°ãƒ—ãƒªã‚»ãƒƒãƒˆ</span>
                    </div>
                    <div class="row">
                        <label>æ–½è¨­ç¨®åˆ¥
                            <select id="facilityType">
                                <option value="yuryo">ä½å®…å‹/ä»‹è­·ä»˜ æœ‰æ–™ï¼ˆæ¨™æº–ï¼‰</option>
                                <option value="sakouju">ã‚µé«˜ä½ï¼ˆæ¨™æº–ï¼‰</option>
                                <option value="groupHome">ã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ ï¼ˆæ¨™æº–ï¼‰</option>
                                <option value="tokuyo">ç‰¹é¤Šï¼ˆæ¨™æº–ï¼‰</option>
                            </select>
                        </label>
                        <label>å…¥å±…è€…æ•°ï¼ˆäººï¼‰
                            <input type="number" id="residents" value="100" min="10" step="1">
                        </label>
                        <label>å±…å®¤æ§‹æˆ
                            <select id="roomPlan">
                                <option value="private_only">å…¨å®¤å€‹å®¤</option>
                                <option value="mixed">å€‹å®¤ï¼‹å¤šåºŠå®¤</option>
                            </select>
                        </label>
                        <label>å€‹å®¤é¢ç©ï¼ˆã¡/å®¤ï¼‰
                            <select id="privateAreaPreset">
                                <option value="13">13ã¡</option>
                                <option value="18" selected>18ã¡</option>
                                <option value="22">22ã¡</option>
                                <option value="custom">ã‚«ã‚¹ã‚¿ãƒ </option>
                            </select>
                        </label>
                        <label>å€‹å®¤é¢ç©ï¼ˆã‚«ã‚¹ã‚¿ãƒ ï¼‰
                            <input type="number" id="privateArea" value="18" min="10" step="0.5">
                        </label>
                    </div>
                    <div class="row" style="margin-top: 0.5rem;">
                        <label>å®¶æ—éƒ¨å±‹ï¼ˆå®¤æ•°ï¼‰
                            <input type="number" id="familyRooms" value="0" min="0" step="1">
                        </label>
                        <label>å®¶æ—éƒ¨å±‹ï¼ˆã¡/å®¤ï¼‰
                            <input type="number" id="familyRoomArea" value="25" min="10" step="1">
                        </label>
                        <label>å…±ç”¨éƒ¨ä¿‚æ•°
                            <input type="number" id="commonFactor" value="1.00" min="0.70" max="1.60" step="0.01">
                        </label>
                    </div>
                    <div class="hr"></div>
                    <div class="sectionTitle"><h2 style="font-size: 0.8rem;">å¤šåºŠå®¤ï¼ˆä»»æ„ï¼‰</h2><span class="badge">æ··åˆæ™‚ã®ã¿</span></div>
                    <div class="row">
                        <label>å¤šåºŠå®¤ã®å®¤æ•°
                            <input type="number" id="multiRooms" value="0" min="0" step="1">
                        </label>
                        <label>1å®¤ã‚ãŸã‚Šäººæ•°
                            <select id="bedsPerRoom">
                                <option value="2">2äººéƒ¨å±‹</option>
                                <option value="4" selected>4äººéƒ¨å±‹</option>
                            </select>
                        </label>
                        <label>å¤šåºŠã®é¢ç©ï¼ˆã¡/äººï¼‰
                            <select id="multiAreaPerPerson">
                                <option value="7">7ã¡</option>
                                <option value="8" selected>8ã¡</option>
                                <option value="9">9ã¡</option>
                            </select>
                        </label>
                    </div>
                    <div class="row" style="margin-top: 0.5rem;">
                        <span class="pill">å€‹å®¤ï¼š<b id="privateRoomsOut">0</b> å®¤</span>
                        <span class="pill">å¤šåºŠï¼š<b id="multiBedsOut">0</b> äººåˆ†</span>
                        <span class="pill highlight">å°‚æœ‰ï¼š<b id="net_m2_out">0</b> ã¡</span>
                        <span class="pill highlight">å»¶åºŠï¼š<b id="gfa_m2_out">0</b> ã¡</span>
                    </div>
                </div>

                <!-- 1. å»ºç¯‰æ¡ä»¶ -->
                <div class="card">
                    <div class="sectionTitle">
                        <h2><span class="num">1</span> å»ºç¯‰æ¡ä»¶ï¼ˆ47éƒ½é“åºœçœŒï¼‰</h2>
                        <span class="badge">Aå·¥äº‹å˜ä¾¡ãƒ™ãƒ¼ã‚¹</span>
                    </div>
                    <div class="row">
                        <label>éƒ½é“åºœçœŒ
                            <select id="pref"></select>
                        </label>
                        <label>æ§‹é€ 
                            <select id="structure">
                                <option value="RCé€ ï¼ˆåœ¨æ¥ï¼‰">RCé€ ï¼ˆåœ¨æ¥ï¼‰</option>
                                <option value="Sé€ ï¼ˆä¸€èˆ¬ï¼‰">Sé€ ï¼ˆé‰„éª¨ï¼‰</option>
                                <option value="æœ¨é€ ï¼ˆæº–è€ç«ï¼‰">æœ¨é€ ï¼ˆæº–è€ç«ï¼‰</option>
                                <option value="SRé€ ï¼ˆSRCæƒ³å®šï¼‰">SRCé€ </option>
                            </select>
                        </label>
                        <label>éšæ•°
                            <select id="floors">
                                <option value="1">å¹³å±‹</option>
                                <option value="2" selected>2éš</option>
                                <option value="3">3éš</option>
                                <option value="4">4éš</option>
                                <option value="5">5éš</option>
                                <option value="6">6éš</option>
                                <option value="7">7éš</option>
                                <option value="8">8éš</option>
                                <option value="9">9éš</option>
                                <option value="10">10éš</option>
                            </select>
                        </label>
                        <label>å»¶åºŠé¢ç©ï¼ˆã¡ï¼‰â€»è‡ªå‹•
                            <input type="number" id="gfa_m2" value="0" min="0" step="1">
                        </label>
                    </div>
                    <div class="row" style="margin-top: 0.5rem;">
                        <label>å…±ç”¨éƒ¨ã®åºƒã•
                            <select id="buildingType">
                                <option value="roomcentric">ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼ˆ60%ï¼‰</option>
                                <option value="apartment">æ¨™æº–ï¼ˆ50%ï¼‰</option>
                                <option value="hotel">ã‚†ã£ãŸã‚Šï¼ˆ40%ï¼‰</option>
                            </select>
                        </label>
                        <label>ç”¨é€”ä¿‚æ•°
                            <input type="number" id="useFactor" value="1.25" min="0.80" max="2.00" step="0.01">
                        </label>
                        <label>æŒ‡æ•°èª¿æ•´
                            <input type="number" id="indexFactor" value="1.10" min="0.50" max="2.50" step="0.01">
                        </label>
                    </div>
                    <!-- éè¡¨ç¤ºã®ãƒ¬ãƒ³ã‚¿ãƒ–ãƒ«æ¯”ï¼ˆå†…éƒ¨è¨ˆç®—ç”¨ï¼‰ -->
                    <input type="hidden" id="rentable_ratio" value="50">
                    <div class="row" style="margin-top: 0.5rem;">
                        <div class="pill">å˜ä¾¡ï¼ˆå††/ã¡ï¼‰<b id="unit_cost">0</b></div>
                        <div class="pill">éšæ•°ä¿‚æ•° <b id="floor_factor_out">1.00</b></div>
                        <div class="pill highlight">å»ºç¯‰è²»ï¼ˆè‡ªå‹•ï¼‰<b id="build_cost_range">Â¥0ã€œÂ¥0</b></div>
                    </div>
                    <p class="hint" id="floorHint">ğŸ’¡ 2éšå»ºã¦åŸºæº–ã€‚6éšä»¥ä¸Šã¯æ§‹é€ ãƒ»æ¶ˆé˜²è¨­å‚™ãŒå¤§å¹…ã«å¢—åŠ ã—ã¾ã™ã€‚</p>
                </div>

                <!-- 2. åœŸåœ° -->
                <div class="card">
                    <div class="sectionTitle">
                        <h2><span class="num">2</span> ä»•å…¥ãƒ»åœŸåœ°é–¢é€£è²»</h2>
                        <span class="badge">è¦æ¨¡Ã—åœ°ä¾¡ã§è‡ªå‹•</span>
                    </div>
                    <div class="row">
                        <label>åœŸåœ°å½¢æ…‹
                            <select id="landMode">
                                <option value="purchase">è³¼å…¥ï¼ˆæ‰€æœ‰ï¼‰</option>
                                <option value="lease">å€Ÿåœ°ï¼ˆè³ƒå€Ÿï¼‰</option>
                            </select>
                        </label>
                        <label>æ¶ˆè²»ç¨ç‡ï¼ˆ%ï¼‰<input type="number" id="taxRate" value="10" min="0" max="20" step="1"></label>
                        <label>è‡ªå‹•è¨ˆç®—
                            <select id="landAuto">
                                <option value="auto" selected>ONï¼ˆè‡ªå‹•ï¼‰</option>
                                <option value="manual">OFFï¼ˆæ‰‹å…¥åŠ›ï¼‰</option>
                            </select>
                        </label>
                        <label>è©•ä¾¡æ¯”ç‡<input type="number" id="assessedRatio" value="0.70" min="0.30" max="1.20" step="0.01"></label>
                    </div>
                    <div class="row" style="margin-top: 0.5rem;">
                        <label>åœŸåœ°ä»•å…¥ä¾¡æ ¼ï¼ˆç¨æŠœï¼‰<br><small style="color:var(--primary);">â€»è³¼å…¥æ™‚ã®ã¿</small><input type="text" id="land_price" value="0" inputmode="numeric"></label>
                        <label>æœˆé¡åœ°ä»£ï¼ˆå€Ÿåœ°ï¼‰<br><small style="color:var(--primary);">â€»å€Ÿåœ°æ™‚ã®ã¿</small><input type="text" id="ground_rent_month" value="0" inputmode="numeric"></label>
                        <label>é€ æˆä¿‚æ•°<input type="number" id="siteWorkFactor" value="1.00" min="0.50" max="3.00" step="0.01"></label>
                    </div>
                    <div class="row" style="margin-top: 0.5rem;">
                        <label>ä¿è¨¼é‡‘ï¼ˆæœˆæ•°ï¼‰<input type="number" id="deposit_months" value="12" min="0" max="60" step="1"></label>
                        <label>ç¤¼é‡‘ï¼ˆæœˆæ•°ï¼‰<input type="number" id="key_months" value="0" min="0" max="24" step="1"></label>
                        <label>åœŸåœ°è«¸è²»ç”¨ï¼ˆè¿½åŠ ï¼‰<input type="text" id="landFees_net" value="0" inputmode="numeric"></label>
                        <label>è‡ªå‹•ç®—å‡ºé¡<input type="text" id="landFees_auto_net" value="0" disabled></label>
                    </div>
                    <div class="row" style="margin-top: 0.5rem;">
                        <div class="pill">æ•·åœ°é¢ç©ï¼ˆè‡ªå‹•ï¼‰<b id="site_area_out">0</b> ã¡</div>
                        <div class="pill">å»ºç¯‰é¢ç© <b id="building_area_out">0</b> ã¡</div>
                    </div>
                    <p class="hint" id="landHint">ğŸ’¡ æ•·åœ°é¢ç© = (å»¶åºŠé¢ç© Ã· éšæ•°) Ã— 1.8ï¼ˆå»ºè”½ç‡55%+ä½™è£•ï¼‰ã§è‡ªå‹•è¨ˆç®—</p>
                </div>

                <!-- 3. å»ºç¯‰è²»ãã®ä»– -->
                <div class="card">
                    <div class="sectionTitle">
                        <h2><span class="num">3</span> å»ºç¯‰è²»ãã®ä»–</h2>
                        <span class="badge">å»ºç¯‰è²»é€£å‹•ã§è‡ªå‹•</span>
                    </div>
                    <div class="row">
                        <label>è¨­è¨ˆãƒ»ç®¡ç†è²»ï¼ˆç¨æŠœï¼‰<br><small style="color:var(--primary);">â€»å»ºç¯‰è²»ã®6%</small><input type="text" id="designMgmt_net" value="0" inputmode="numeric"></label>
                        <label>ç™»è¨˜ãƒ»å£«æ¥­ç­‰ï¼ˆç¨æŠœï¼‰<br><small style="color:var(--primary);">â€»å»ºç¯‰è²»ã®0.8%</small><input type="text" id="registry_net" value="0" inputmode="numeric"></label>
                        <label>äºˆå‚™è²»ï¼ˆç¨æŠœï¼‰<br><small style="color:var(--primary);">â€»å»ºç¯‰è²»ã®4%</small><input type="text" id="contingency_net" value="0" inputmode="numeric"></label>
                        <label>ãƒªãƒ¼ã‚·ãƒ³ã‚°<br><small style="color:var(--primary);">â€»å…¥å±…è€…Ã—5ä¸‡</small><input type="text" id="leasing_net" value="0" inputmode="numeric"></label>
                        <label>ç«‹ã¡é€€ã<input type="text" id="relocation_net" value="0" inputmode="numeric"></label>
                    </div>
                    <p class="hint">ğŸ’¡ å»ºç¯‰è²»ï¼ˆä¸­å¤®å€¤ï¼‰ã‚’åŸºæº–ã«è‡ªå‹•ã‚»ãƒƒãƒˆã€‚ä¸Šæ›¸ãå¯èƒ½ã§ã™ã€‚</p>
                </div>

                <!-- 4. é–‹ç™ºä½œæ¥­ -->
                <div class="card">
                    <div class="sectionTitle">
                        <h2><span class="num">4</span> é–‹ç™ºä½œæ¥­ï¼ˆé¸æŠï¼‰</h2>
                        <span class="badge">Development_Master</span>
                    </div>
                    <div id="tasksByPhase"></div>
                </div>

                <!-- 5. é–‹æ¥­æº–å‚™ -->
                <div class="card">
                    <div class="sectionTitle">
                        <h2><span class="num">5</span> é–‹æ¥­æº–å‚™</h2>
                        <span class="badge">D Phase</span>
                    </div>
                    <div id="tasksByPhaseD"></div>
                </div>
            </div>

            <!-- Right: Summary -->
            <div class="summary-sidebar">
                <div class="summary-card">
                    <h3>ğŸ“Š æ¦‚ç®—ã‚µãƒãƒªãƒ¼</h3>
                    <table>
                        <thead><tr><th>åŒºåˆ†</th><th class="num">ç¨æŠœ</th><th class="num">ç¨è¾¼</th></tr></thead>
                        <tbody id="summaryTable"></tbody>
                    </table>
                    <div class="total">
                        <div>
                            <div class="small">ãƒˆãƒ¼ã‚¿ãƒ«ã‚¤ãƒ³ãƒ™ã‚¹ãƒˆãƒ¡ãƒ³ãƒˆ</div>
                            <strong id="totalInv">Â¥0ã€œÂ¥0</strong>
                        </div>
                    </div>
                    <div class="hr"></div>
                    <div class="sectionTitle" style="margin-bottom: 0.3rem;">
                        <h2 style="font-size: 0.8rem;">åå…¥ â†’ NOI/åˆ©å›ã‚Š</h2>
                        <span class="badge">NOIåˆ©å›ã‚Š6%åŸºæº–</span>
                    </div>
                    <div class="row">
                        <label>æœˆé¡è³ƒæ–™<br><small style="color:var(--primary);">â€»NOI6%ã§é€†ç®—</small><input type="text" id="rent_month" value="0" inputmode="numeric"></label>
                        <label>ãã®ä»–/æœˆ<br><small style="color:var(--primary);">â€»è³ƒæ–™ã®8%</small><input type="text" id="other_month" value="0" inputmode="numeric"></label>
                    </div>
                    <div class="row" style="margin-top: 0.3rem;">
                        <label>ç®¡ç†è²»/æœˆ<br><small style="color:var(--primary);">â€»è³ƒæ–™ã®8%</small><input type="text" id="mgmt_month" value="0" inputmode="numeric"></label>
                        <label>åœŸåœ°ç¨/å¹´<br><small style="color:var(--primary);">â€»è³¼å…¥æ™‚ã®ã¿</small><input type="text" id="tax_land_year" value="0" inputmode="numeric"></label>
                        <label>å»ºç‰©ç¨/å¹´<br><small style="color:var(--primary);">â€»å»ºç¯‰è²»ã®0.4%</small><input type="text" id="tax_bldg_year" value="0" inputmode="numeric"></label>
                    </div>
                    <p class="hint">ğŸ’¡ NOIåˆ©å›ã‚Š6%ã‚’åŸºæº–ã«æœˆé¡è³ƒæ–™ã‚’é€†ç®—ã€‚è³ƒæ–™ã‚’å¤‰æ›´ã™ã‚‹ã¨åˆ©å›ã‚ŠãŒå¤‰åŒ–ã—ã¾ã™ã€‚</p>
                    <div class="yield-box">
                        <div class="label">NOIåˆ©å›ã‚Š</div>
                        <div class="value" id="noi_yield">0%</div>
                        <div class="yield-row">
                            <div><div class="label">è¡¨é¢åˆ©å›ã‚Š</div><div class="value" id="gross_yield">0%</div></div>
                            <div><div class="label">å¹´é–“NOI</div><div class="value" id="noi_year">Â¥0</div></div>
                        </div>
                    </div>
                    <div class="cta">
                        <button class="btn primary" id="btnCalc" style="background:#10B981;">ğŸ”„ è¨ˆç®—ã‚’å®Ÿè¡Œ</button>
                        <button class="btn primary" id="btnToMember">ä¼šå“¡ãƒšãƒ¼ã‚¸ã§è¦‹ç©ä½œæˆ â†’</button>
                        <button class="btn secondary" id="btnSave">ä¿å­˜</button>
                    </div>
                    <p class="hint">ä¿å­˜å…ˆ: localStorage.devSimulation</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-logo">TA<span class="char-m">m</span>J</div>
        <p class="footer-copy">Â© 2025 TAmJ Inc. All rights reserved.</p>
    </footer>

    <script>
        const M2_TO_TSUBO = 1/3.305785;
        function yen(n){ return "Â¥"+Math.round(Number(n||0)).toLocaleString("ja-JP"); }
        function yenShort(n){ n=Number(n||0); if(n>=1e8) return "Â¥"+(n/1e8).toFixed(2)+"å„„"; if(n>=1e4) return "Â¥"+Math.round(n/1e4).toLocaleString()+"ä¸‡"; return yen(n); }
        function yenRange(min,max){ return `${yenShort(min)}ã€œ${yenShort(max)}`; }
        function num(id){ 
            const el=document.getElementById(id); 
            if(!el) return 0;
            // ã‚«ãƒ³ãƒã‚’é™¤å»ã—ã¦æ•°å€¤ã«å¤‰æ›
            const v = String(el.value||0).replace(/,/g, '');
            return Number(v) || 0;
        }
        function setText(id, txt){ const el=document.getElementById(id); if(el) el.textContent=txt; }
        function setVal(id, v){ 
            const el=document.getElementById(id); 
            if(!el) return;
            // é‡‘é¡ç³»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã‚«ãƒ³ãƒä»˜ãã§è¡¨ç¤º
            const moneyFields = ['land_price','ground_rent_month','landFees_net','landFees_auto_net','designMgmt_net','registry_net','contingency_net','leasing_net','relocation_net','rent_month','other_month','mgmt_month','tax_land_year','tax_bldg_year'];
            if(moneyFields.includes(id) && el.type !== 'number'){
                el.value = Number(v).toLocaleString('ja-JP');
            } else {
                el.value = v;
            }
        }

        let devData=null, buildData=null;
        let state={ selectedTasks:new Set(), build:{unit:0,min:0,max:0}, devTasksCost:{min:0,max:0}, landFeesAuto:0, summary:{} };

        // é–‹ç™ºã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ï¼‰
        const DEV_DATA = {
            phases: [
                { id: "A", name: "ä¼ç”»ãƒ»åŸºæœ¬è¨­è¨ˆ" },
                { id: "B", name: "å®Ÿæ–½è¨­è¨ˆãƒ»è¡Œæ”¿æ‰‹ç¶š" },
                { id: "C", name: "æ–½å·¥ãƒ»æ•´å‚™" },
                { id: "D", name: "é–‹æ¥­æº–å‚™" }
            ],
            tasks: [
                { phaseId: "A", id: "A-01", name: "äº‹æ¥­æ§‹æƒ³æ•´ç†", description: "ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ»æ–¹å‘æ€§æ•´ç†", display: true },
                { phaseId: "A", id: "A-02", name: "ç°¡æ˜“åæ”¯ãƒ¢ãƒ‡ãƒ«ä½œæˆ", description: "åˆæœŸè²»ç”¨ãƒ»æœˆæ¬¡æ¦‚ç®—", display: true },
                { phaseId: "A", id: "A-03", name: "æ–½è¨­ã‚³ãƒ³ã‚»ãƒ—ãƒˆè¨­è¨ˆ", description: "ä»‹è­·ç¨®åˆ¥ãƒ»ç‰¹å¾´è¨­è¨ˆ", display: true },
                { phaseId: "B", id: "B-01", name: "åŸºæœ¬è¨­è¨ˆ", description: "å¹³é¢ãƒ»å‹•ç·šè¨ˆç”»", display: true },
                { phaseId: "B", id: "B-02", name: "å®Ÿæ–½è¨­è¨ˆ", description: "æ–½å·¥å¯èƒ½å›³é¢ä½œæˆ", display: true },
                { phaseId: "B", id: "B-03", name: "è¡Œæ”¿å”è­°", description: "æ¶ˆé˜²ãƒ»ä¿å¥æ‰€ãƒ»è¡Œæ”¿æŠ˜è¡", display: true },
                { phaseId: "C", id: "C-01", name: "æ–½å·¥ç®¡ç†", description: "å·¥ç¨‹ãƒ»å“è³ªç®¡ç†", display: true },
                { phaseId: "C", id: "C-02", name: "ä»€å™¨å‚™å“é¸å®š", description: "å®¶å…·ãƒ»å‚™å“ãƒ»åŒ»ç™‚æ©Ÿå™¨", display: true },
                { phaseId: "D", id: "D-01", name: "æ¡ç”¨è¨ˆç”»", description: "è·ç¨®ãƒ»äººæ•°è¨­è¨ˆ", display: true },
                { phaseId: "D", id: "D-02", name: "ç ”ä¿®ãƒ»æ•™è‚²", description: "é–‹æ¥­å‰ç ”ä¿®", display: true },
                { phaseId: "D", id: "D-03", name: "é–‹æ¥­ç«‹ä¼šãƒ»æ¤œæŸ»", description: "è¡Œæ”¿æ¤œæŸ»å¯¾å¿œ", display: true }
            ],
            costRanges: {
                "A-01": { min: 300000, max: 800000, note: "è¦æ¨¡ã«ã‚ˆã‚Šå¤‰å‹•" },
                "A-02": { min: 200000, max: 600000, note: "ç°¡æ˜“ãƒ¢ãƒ‡ãƒ«" },
                "A-03": { min: 300000, max: 1000000, note: "ã‚³ãƒ³ã‚»ãƒ—ãƒˆæ¬¡ç¬¬" },
                "B-01": { min: 1500000, max: 4000000, note: "è¦æ¨¡ä¾å­˜" },
                "B-02": { min: 2000000, max: 6000000, note: "å®Ÿæ–½è¨­è¨ˆ" },
                "B-03": { min: 300000, max: 1000000, note: "è¡Œæ”¿ä»¶æ•°æ¬¡ç¬¬" },
                "C-01": { min: 0, max: 0, note: "å·¥äº‹è²»ç‡" },
                "C-02": { min: 0, max: 0, note: "ä»€å™¨å‚™å“ãƒã‚¹ã‚¿é€£å‹•" },
                "D-01": { min: 0, max: 0, note: "æ¡ç”¨äººæ•°ä¾å­˜" },
                "D-02": { min: 200000, max: 800000, note: "ç ”ä¿®å†…å®¹ä¾å­˜" },
                "D-03": { min: 100000, max: 300000, note: "ç«‹ä¼šå›æ•°ä¾å­˜" }
            }
        };

        // å»ºç¯‰å˜ä¾¡ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ»47éƒ½é“åºœçœŒï¼‰
        const BUILD_DATA = {
            prefectures: [
                { id: "åŒ—æµ·é“", name: "åŒ—æµ·é“", a_unit_yen_per_m2: { est: 430000, min: 400000, max: 460000 }, land_yen_per_m2: 50000, rent_yen_per_m2_month: 150 },
                { id: "é’æ£®", name: "é’æ£®", a_unit_yen_per_m2: { est: 404000, min: 376000, max: 432000 }, land_yen_per_m2: 30000, rent_yen_per_m2_month: 80 },
                { id: "å²©æ‰‹", name: "å²©æ‰‹", a_unit_yen_per_m2: { est: 404000, min: 376000, max: 432000 }, land_yen_per_m2: 30000, rent_yen_per_m2_month: 80 },
                { id: "å®®åŸ", name: "å®®åŸ", a_unit_yen_per_m2: { est: 421000, min: 392000, max: 451000 }, land_yen_per_m2: 80000, rent_yen_per_m2_month: 250 },
                { id: "ç§‹ç”°", name: "ç§‹ç”°", a_unit_yen_per_m2: { est: 400000, min: 372000, max: 428000 }, land_yen_per_m2: 25000, rent_yen_per_m2_month: 70 },
                { id: "å±±å½¢", name: "å±±å½¢", a_unit_yen_per_m2: { est: 400000, min: 372000, max: 428000 }, land_yen_per_m2: 30000, rent_yen_per_m2_month: 80 },
                { id: "ç¦å³¶", name: "ç¦å³¶", a_unit_yen_per_m2: { est: 413000, min: 384000, max: 442000 }, land_yen_per_m2: 40000, rent_yen_per_m2_month: 120 },
                { id: "èŒ¨åŸ", name: "èŒ¨åŸ", a_unit_yen_per_m2: { est: 430000, min: 400000, max: 460000 }, land_yen_per_m2: 50000, rent_yen_per_m2_month: 150 },
                { id: "æ ƒæœ¨", name: "æ ƒæœ¨", a_unit_yen_per_m2: { est: 426000, min: 396000, max: 456000 }, land_yen_per_m2: 45000, rent_yen_per_m2_month: 130 },
                { id: "ç¾¤é¦¬", name: "ç¾¤é¦¬", a_unit_yen_per_m2: { est: 426000, min: 396000, max: 456000 }, land_yen_per_m2: 45000, rent_yen_per_m2_month: 130 },
                { id: "åŸ¼ç‰", name: "åŸ¼ç‰", a_unit_yen_per_m2: { est: 456000, min: 424000, max: 488000 }, land_yen_per_m2: 150000, rent_yen_per_m2_month: 450 },
                { id: "åƒè‘‰", name: "åƒè‘‰", a_unit_yen_per_m2: { est: 452000, min: 420000, max: 484000 }, land_yen_per_m2: 120000, rent_yen_per_m2_month: 350 },
                { id: "æ±äº¬23åŒº", name: "æ±äº¬23åŒº", a_unit_yen_per_m2: { est: 560000, min: 520000, max: 600000 }, land_yen_per_m2: 850000, rent_yen_per_m2_month: 2500 },
                { id: "æ±äº¬ï¼ˆãã®ä»–ï¼‰", name: "æ±äº¬ï¼ˆãã®ä»–ï¼‰", a_unit_yen_per_m2: { est: 490000, min: 455000, max: 525000 }, land_yen_per_m2: 280000, rent_yen_per_m2_month: 700 },
                { id: "ç¥å¥ˆå·", name: "ç¥å¥ˆå·", a_unit_yen_per_m2: { est: 499000, min: 464000, max: 534000 }, land_yen_per_m2: 200000, rent_yen_per_m2_month: 600 },
                { id: "æ–°æ½Ÿ", name: "æ–°æ½Ÿ", a_unit_yen_per_m2: { est: 421000, min: 392000, max: 451000 }, land_yen_per_m2: 40000, rent_yen_per_m2_month: 120 },
                { id: "å¯Œå±±", name: "å¯Œå±±", a_unit_yen_per_m2: { est: 417000, min: 388000, max: 446000 }, land_yen_per_m2: 40000, rent_yen_per_m2_month: 120 },
                { id: "çŸ³å·", name: "çŸ³å·", a_unit_yen_per_m2: { est: 421000, min: 392000, max: 451000 }, land_yen_per_m2: 50000, rent_yen_per_m2_month: 150 },
                { id: "ç¦äº•", name: "ç¦äº•", a_unit_yen_per_m2: { est: 413000, min: 384000, max: 442000 }, land_yen_per_m2: 35000, rent_yen_per_m2_month: 100 },
                { id: "å±±æ¢¨", name: "å±±æ¢¨", a_unit_yen_per_m2: { est: 426000, min: 396000, max: 456000 }, land_yen_per_m2: 40000, rent_yen_per_m2_month: 120 },
                { id: "é•·é‡", name: "é•·é‡", a_unit_yen_per_m2: { est: 421000, min: 392000, max: 451000 }, land_yen_per_m2: 45000, rent_yen_per_m2_month: 130 },
                { id: "å²é˜œ", name: "å²é˜œ", a_unit_yen_per_m2: { est: 430000, min: 400000, max: 460000 }, land_yen_per_m2: 50000, rent_yen_per_m2_month: 150 },
                { id: "é™å²¡", name: "é™å²¡", a_unit_yen_per_m2: { est: 443000, min: 412000, max: 474000 }, land_yen_per_m2: 70000, rent_yen_per_m2_month: 200 },
                { id: "æ„›çŸ¥", name: "æ„›çŸ¥", a_unit_yen_per_m2: { est: 473000, min: 440000, max: 506000 }, land_yen_per_m2: 150000, rent_yen_per_m2_month: 450 },
                { id: "ä¸‰é‡", name: "ä¸‰é‡", a_unit_yen_per_m2: { est: 434000, min: 403000, max: 465000 }, land_yen_per_m2: 50000, rent_yen_per_m2_month: 150 },
                { id: "æ»‹è³€", name: "æ»‹è³€", a_unit_yen_per_m2: { est: 439000, min: 408000, max: 470000 }, land_yen_per_m2: 60000, rent_yen_per_m2_month: 180 },
                { id: "äº¬éƒ½", name: "äº¬éƒ½", a_unit_yen_per_m2: { est: 464000, min: 431000, max: 497000 }, land_yen_per_m2: 150000, rent_yen_per_m2_month: 450 },
                { id: "å¤§é˜ª", name: "å¤§é˜ª", a_unit_yen_per_m2: { est: 490000, min: 456000, max: 524000 }, land_yen_per_m2: 200000, rent_yen_per_m2_month: 600 },
                { id: "å…µåº«", name: "å…µåº«", a_unit_yen_per_m2: { est: 460000, min: 428000, max: 492000 }, land_yen_per_m2: 100000, rent_yen_per_m2_month: 300 },
                { id: "å¥ˆè‰¯", name: "å¥ˆè‰¯", a_unit_yen_per_m2: { est: 443000, min: 412000, max: 474000 }, land_yen_per_m2: 70000, rent_yen_per_m2_month: 200 },
                { id: "å’Œæ­Œå±±", name: "å’Œæ­Œå±±", a_unit_yen_per_m2: { est: 430000, min: 400000, max: 460000 }, land_yen_per_m2: 40000, rent_yen_per_m2_month: 120 },
                { id: "é³¥å–", name: "é³¥å–", a_unit_yen_per_m2: { est: 409000, min: 380000, max: 438000 }, land_yen_per_m2: 30000, rent_yen_per_m2_month: 80 },
                { id: "å³¶æ ¹", name: "å³¶æ ¹", a_unit_yen_per_m2: { est: 409000, min: 380000, max: 438000 }, land_yen_per_m2: 30000, rent_yen_per_m2_month: 80 },
                { id: "å²¡å±±", name: "å²¡å±±", a_unit_yen_per_m2: { est: 430000, min: 400000, max: 460000 }, land_yen_per_m2: 60000, rent_yen_per_m2_month: 180 },
                { id: "åºƒå³¶", name: "åºƒå³¶", a_unit_yen_per_m2: { est: 439000, min: 408000, max: 470000 }, land_yen_per_m2: 80000, rent_yen_per_m2_month: 250 },
                { id: "å±±å£", name: "å±±å£", a_unit_yen_per_m2: { est: 421000, min: 392000, max: 451000 }, land_yen_per_m2: 35000, rent_yen_per_m2_month: 100 },
                { id: "å¾³å³¶", name: "å¾³å³¶", a_unit_yen_per_m2: { est: 413000, min: 384000, max: 442000 }, land_yen_per_m2: 40000, rent_yen_per_m2_month: 120 },
                { id: "é¦™å·", name: "é¦™å·", a_unit_yen_per_m2: { est: 421000, min: 392000, max: 451000 }, land_yen_per_m2: 50000, rent_yen_per_m2_month: 150 },
                { id: "æ„›åª›", name: "æ„›åª›", a_unit_yen_per_m2: { est: 417000, min: 388000, max: 446000 }, land_yen_per_m2: 45000, rent_yen_per_m2_month: 130 },
                { id: "é«˜çŸ¥", name: "é«˜çŸ¥", a_unit_yen_per_m2: { est: 409000, min: 380000, max: 438000 }, land_yen_per_m2: 35000, rent_yen_per_m2_month: 100 },
                { id: "ç¦å²¡", name: "ç¦å²¡", a_unit_yen_per_m2: { est: 456000, min: 424000, max: 488000 }, land_yen_per_m2: 100000, rent_yen_per_m2_month: 300 },
                { id: "ä½è³€", name: "ä½è³€", a_unit_yen_per_m2: { est: 417000, min: 388000, max: 446000 }, land_yen_per_m2: 35000, rent_yen_per_m2_month: 100 },
                { id: "é•·å´", name: "é•·å´", a_unit_yen_per_m2: { est: 417000, min: 388000, max: 446000 }, land_yen_per_m2: 45000, rent_yen_per_m2_month: 130 },
                { id: "ç†Šæœ¬", name: "ç†Šæœ¬", a_unit_yen_per_m2: { est: 421000, min: 392000, max: 451000 }, land_yen_per_m2: 50000, rent_yen_per_m2_month: 150 },
                { id: "å¤§åˆ†", name: "å¤§åˆ†", a_unit_yen_per_m2: { est: 413000, min: 384000, max: 442000 }, land_yen_per_m2: 40000, rent_yen_per_m2_month: 120 },
                { id: "å®®å´", name: "å®®å´", a_unit_yen_per_m2: { est: 409000, min: 380000, max: 438000 }, land_yen_per_m2: 35000, rent_yen_per_m2_month: 100 },
                { id: "é¹¿å…å³¶", name: "é¹¿å…å³¶", a_unit_yen_per_m2: { est: 413000, min: 384000, max: 442000 }, land_yen_per_m2: 40000, rent_yen_per_m2_month: 120 },
                { id: "æ²–ç¸„", name: "æ²–ç¸„", a_unit_yen_per_m2: { est: 439000, min: 408000, max: 470000 }, land_yen_per_m2: 80000, rent_yen_per_m2_month: 250 }
            ],
            switches: [
                { category: "æ§‹é€ _è©³ç´°", option: "RCé€ ï¼ˆåœ¨æ¥ï¼‰", value: 1.07 },
                { category: "æ§‹é€ _è©³ç´°", option: "Sé€ ï¼ˆä¸€èˆ¬ï¼‰", value: 1.0 },
                { category: "æ§‹é€ _è©³ç´°", option: "æœ¨é€ ï¼ˆæº–è€ç«ï¼‰", value: 0.95 },
                { category: "æ§‹é€ _è©³ç´°", option: "SRé€ ï¼ˆSRCæƒ³å®šï¼‰", value: 1.09 }
            ]
        };

        const COEF_PRESETS = {
            tokuyo: { defaults:{ privateArea:13, buildingType:"apartment", rentableRatio:50, useFactor:1.35, commonFactor:1.05 }},
            yuryo: { defaults:{ privateArea:18, buildingType:"apartment", rentableRatio:50, useFactor:1.25, commonFactor:1.00 }},
            sakouju: { defaults:{ privateArea:18, buildingType:"roomcentric", rentableRatio:55, useFactor:1.15, commonFactor:0.95 }},
            groupHome: { defaults:{ privateArea:13, buildingType:"roomcentric", rentableRatio:55, useFactor:1.20, commonFactor:1.00 }}
        };

        function applyFacilityPreset(){
            const p=COEF_PRESETS[document.getElementById("facilityType").value]; if(!p) return;
            setVal("privateAreaPreset", String(p.defaults.privateArea));
            setVal("privateArea", p.defaults.privateArea);
            document.getElementById("privateArea").disabled=true;
            setVal("buildingType", p.defaults.buildingType);
            setVal("rentable_ratio", p.defaults.rentableRatio);
            setVal("useFactor", p.defaults.useFactor);
            setVal("commonFactor", p.defaults.commonFactor);
        }

        function syncPrivateArea(){
            const preset=document.getElementById("privateAreaPreset").value;
            const input=document.getElementById("privateArea");
            if(preset==="custom"){ input.disabled=false; } else { input.disabled=true; input.value=preset; }
        }

        function syncBuildingTypeToRatio(){
            const map={ roomcentric:60, apartment:50, hotel:40 };
            setVal("rentable_ratio", map[document.getElementById("buildingType").value]??50);
        }

        function calcFacilityToAreas(){
            const plan=document.getElementById("roomPlan").value;
            const residents=Math.max(0, num("residents"));
            const privateArea=Math.max(10, num("privateArea"));
            let multiRooms=Math.max(0, num("multiRooms"));
            const bedsPerRoom=Number(document.getElementById("bedsPerRoom").value||4);
            const multiAreaPerPerson=Number(document.getElementById("multiAreaPerPerson").value||8);
            if(plan==="private_only"){ multiRooms=0; setVal("multiRooms",0); }
            const multiBeds=multiRooms*bedsPerRoom;
            const privateBeds=Math.max(0, residents-multiBeds);
            const famRooms=Math.max(0, num("familyRooms"));
            const famArea=Math.max(0, num("familyRoomArea"));
            let netM2=(privateBeds*privateArea)+(multiBeds*multiAreaPerPerson)+(famRooms*famArea);
            netM2*=Math.min(1.60, Math.max(0.70, num("commonFactor")||1.0));
            const ratioPct=Math.min(70, Math.max(30, num("rentable_ratio")||50));
            const gfa=(ratioPct>0)?(netM2/(ratioPct/100)):0;
            setText("privateRoomsOut", privateBeds.toLocaleString("ja-JP"));
            setText("multiBedsOut", multiBeds.toLocaleString("ja-JP"));
            setText("net_m2_out", Math.round(netM2).toLocaleString("ja-JP"));
            setText("gfa_m2_out", Math.round(gfa).toLocaleString("ja-JP"));
            setVal("gfa_m2", Math.round(gfa));
        }

        // éšæ•°ä¿‚æ•°ï¼ˆ2éšåŸºæº–=1.00ã€6éšä»¥ä¸Šã§æ€¥ä¸Šæ˜‡ï¼‰
        const FLOOR_FACTORS = {
            1: 0.95,   // å¹³å±‹
            2: 1.00,   // åŸºæº–
            3: 1.08,
            4: 1.15,
            5: 1.22,
            6: 1.32,   // 6éšã®å£ï¼ˆæ§‹é€ ãƒ»æ¶ˆé˜²ï¼‰
            7: 1.38,
            8: 1.43,
            9: 1.48,
            10: 1.55
        };

        // 6éšä»¥ä¸Šã®è¿½åŠ è²»ç”¨ï¼ˆEVãƒ»é˜²ç½è¨­å‚™ï¼‰
        function calcFloorAdditionalCost(floors, gfa){
            let additional = 0;
            if(floors >= 6){
                // ã‚¹ãƒ—ãƒªãƒ³ã‚¯ãƒ©ãƒ¼ãƒ»æ’ç…™ãƒ»éå¸¸ç”¨ç™ºé›»ç­‰ï¼šã¡+15ä¸‡å††
                additional += gfa * 150000;
                // éå¸¸ç”¨EVè¿½åŠ ï¼šç´„8000ä¸‡å††
                additional += 80000000;
            }
            if(floors >= 3){
                // EVåŸºæœ¬ï¼ˆ3éšä»¥ä¸Šï¼‰ï¼šç´„5000ä¸‡å††/åŸº
                const evCount = floors >= 6 ? 2 : 1;
                additional += evCount * 50000000;
            }
            return additional;
        }

        function calcBuildCost(){
            const prefId=document.getElementById("pref").value;
            const structureOpt=document.getElementById("structure").value;
            const gfa=num("gfa_m2");
            const idx=num("indexFactor")||1;
            const use=num("useFactor")||1;
            const floors=parseInt(document.getElementById("floors").value)||2;
            const pref=buildData.prefectures.find(p=>p.id===prefId);
            const baseEst=pref?.a_unit_yen_per_m2?.est??0;
            const baseMin=pref?.a_unit_yen_per_m2?.min??baseEst;
            const baseMax=pref?.a_unit_yen_per_m2?.max??baseEst;
            const structSwitch=buildData.switches?.filter(s=>s.category==="æ§‹é€ _è©³ç´°").find(s=>s.option===structureOpt);
            const structFactor=(typeof structSwitch?.value==="number")?structSwitch.value:1;
            
            // éšæ•°ä¿‚æ•°ã‚’å–å¾—
            const floorFactor = FLOOR_FACTORS[floors] || 1.00;
            setText("floor_factor_out", floorFactor.toFixed(2));
            
            // 6éšä»¥ä¸Šã®è¿½åŠ è²»ç”¨
            const additionalCost = calcFloorAdditionalCost(floors, gfa);
            
            // å˜ä¾¡ã«éšæ•°ä¿‚æ•°ã‚’åæ˜ 
            const effectiveUnitEst=baseEst*structFactor*floorFactor*idx*use;
            const effectiveUnitMin=baseMin*structFactor*floorFactor*idx*use;
            const effectiveUnitMax=baseMax*structFactor*floorFactor*idx*use;
            setText("unit_cost", Math.round(effectiveUnitEst).toLocaleString("ja-JP"));
            
            // å»ºç¯‰è²»ã«è¿½åŠ è²»ç”¨ã‚’åŠ ç®—
            state.build={
                unit: effectiveUnitEst, 
                min: gfa*effectiveUnitMin + additionalCost, 
                max: gfa*effectiveUnitMax + additionalCost,
                floorFactor: floorFactor,
                additionalCost: additionalCost
            };
            setText("build_cost_range", yenRange(state.build.min, state.build.max));
        }

        // ä¸‡å††å˜ä½ã«åˆ‡ã‚Šä¸Šã’
        function roundToMan(n){ return Math.ceil(n / 10000) * 10000; }

        // åœŸåœ°ä¾¡æ ¼ãƒ»åœ°ä»£ã‚’è‡ªå‹•è¨ˆç®—ï¼ˆéƒ½é“åºœçœŒãƒ»å»¶åºŠé¢ç©é€£å‹•ï¼‰
        function calcLandPriceAuto(){
            const prefId = document.getElementById("pref").value;
            const gfa = num("gfa_m2");
            const floors = parseInt(document.getElementById("floors").value) || 2;
            const mode = document.getElementById("landMode").value;
            const pref = buildData.prefectures.find(p => p.id === prefId);
            
            // å»ºç¯‰é¢ç© = å»¶åºŠé¢ç© / éšæ•°
            const buildingArea = gfa / floors;
            // æ•·åœ°é¢ç© = å»ºç¯‰é¢ç© / å»ºè”½ç‡ï¼ˆ55%æƒ³å®šï¼‰+ é§è»Šå ´ç­‰ä½™è£•
            // â†’ å»ºç¯‰é¢ç© Ã— 1.8
            const siteArea = buildingArea * 1.8;
            
            // æ•·åœ°é¢ç©ãƒ»å»ºç¯‰é¢ç©ã‚’è¡¨ç¤º
            setText("site_area_out", Math.round(siteArea).toLocaleString("ja-JP"));
            setText("building_area_out", Math.round(buildingArea).toLocaleString("ja-JP"));
            state.siteArea = Math.round(siteArea);
            state.buildingArea = Math.round(buildingArea);
            
            if(mode === "purchase"){
                // è³¼å…¥ãƒ¢ãƒ¼ãƒ‰ï¼šåœŸåœ°ä¾¡æ ¼ã‚’è¨ˆç®—ã€åœ°ä»£ã¯0ã€ä¿è¨¼é‡‘ãƒ»ç¤¼é‡‘ã‚‚0
                const landUnitPrice = pref?.land_yen_per_m2 || 50000;
                const landPrice = roundToMan(siteArea * landUnitPrice);
                setVal("land_price", landPrice);
                setVal("ground_rent_month", 0);
                setVal("deposit_months", 0);
                setVal("key_months", 0);
                state.landPrice = landPrice;
            } else {
                // å€Ÿåœ°ãƒ¢ãƒ¼ãƒ‰ï¼šåœŸåœ°ä¾¡æ ¼ã¯0ã€æœˆé¡åœ°ä»£ã‚’è¨ˆç®—ã€ä¿è¨¼é‡‘ã¯12ãƒ¶æœˆ
                const rentUnitPrice = pref?.rent_yen_per_m2_month || 150;
                const groundRentMonth = roundToMan(siteArea * rentUnitPrice);
                setVal("land_price", 0);
                setVal("ground_rent_month", groundRentMonth);
                setVal("deposit_months", 12);
                setVal("key_months", 0);
                state.landPrice = 0;
            }
        }

        // å»ºç¯‰è²»ãã®ä»–ã‚’è‡ªå‹•è¨ˆç®—
        function calcOtherCostsAuto(){
            const buildMid = (state.build.min + state.build.max) / 2;
            const residents = num("residents");
            // è¨­è¨ˆãƒ»ç®¡ç†è²»: å»ºç¯‰è²»ã®6%
            setVal("designMgmt_net", roundToMan(buildMid * 0.06));
            // ç™»è¨˜ãƒ»å£«æ¥­ç­‰: å»ºç¯‰è²»ã®0.8%
            setVal("registry_net", roundToMan(buildMid * 0.008));
            // äºˆå‚™è²»: å»ºç¯‰è²»ã®4%
            setVal("contingency_net", roundToMan(buildMid * 0.04));
            // ãƒªãƒ¼ã‚·ãƒ³ã‚°: å…¥å±…è€…æ•° Ã— 5ä¸‡å††ï¼ˆåºƒå‘Šãƒ»ä»²ä»‹è²»ç”¨ï¼‰
            setVal("leasing_net", roundToMan(residents * 50000));
        }

        // åå…¥ãƒ»è²»ç”¨ã‚’è‡ªå‹•è¨ˆç®—ï¼ˆNOIåˆ©å›ã‚Š6%åŸºæº–ï¼‰
        function calcIncomeAuto(){
            const residents = num("residents");
            const landPrice = num("land_price");
            const groundRentMonth = num("ground_rent_month");
            const buildMid = (state.build.min + state.build.max) / 2;
            const taxRate = num("taxRate") || 10;
            const mode = document.getElementById("landMode").value;
            
            // åœŸåœ°å›ºéƒ½ç¨: è³¼å…¥æ™‚ã®ã¿åœŸåœ°ä¾¡æ ¼ã®1%ï¼ˆå¹´é¡ï¼‰ã€å€Ÿåœ°æ™‚ã¯0
            const taxLand = (mode === "purchase") ? roundToMan(landPrice * 0.01) : 0;
            setVal("tax_land_year", taxLand);
            
            // å»ºç‰©å›ºéƒ½ç¨: å»ºç¯‰è²»ã®0.4%ï¼ˆå¹´é¡ãƒ»åˆå¹´åº¦ç›®å®‰ï¼‰
            const taxBldg = roundToMan(buildMid * 0.004);
            setVal("tax_bldg_year", taxBldg);
            
            // æŠ•è³‡ç·é¡ï¼ˆç¨è¾¼ï¼‰ã‚’æ¦‚ç®—
            const autoOn = document.getElementById("landAuto").value === "auto";
            const landFeesNet = (autoOn ? state.landFeesAuto : 0) + num("landFees_net");
            const otherNet = num("designMgmt_net") + num("registry_net") + num("contingency_net") + num("leasing_net") + num("relocation_net");
            const devTasksNet = (state.devTasksCost.min + state.devTasksCost.max) / 2;
            const totalInvNet = landPrice + landFeesNet + buildMid + otherNet + devTasksNet;
            const totalInvGross = totalInvNet * (1 + taxRate / 100);
            
            // NOIåˆ©å›ã‚Š6%åŸºæº–ã§é€†ç®—
            // å€Ÿåœ°ã®å ´åˆã¯åœ°ä»£ã‚’å¹´é–“çµŒè²»ã«åŠ ç®—
            // NOI = å¹´é–“åå…¥ - å¹´é–“æ”¯å‡º
            // å¹´é–“æ”¯å‡º = ç®¡ç†è²»Ã—12 + åœŸåœ°ç¨ + å»ºç‰©ç¨ + åœ°ä»£Ã—12ï¼ˆå€Ÿåœ°æ™‚ï¼‰
            const groundRentYear = groundRentMonth * 12;
            
            const targetNOI = totalInvGross * 0.06;
            // è³ƒæ–™ = (ç›®æ¨™NOI + åœŸåœ°ç¨ + å»ºç‰©ç¨ + åœ°ä»£å¹´é¡) / 12
            const rentMonth = roundToMan((targetNOI + taxLand + taxBldg + groundRentYear) / 12);
            setVal("rent_month", rentMonth);
            
            // ãã®ä»–åå…¥: è³ƒæ–™ã®8%ï¼ˆå…±ç›Šè²»ãƒ»é§è»Šå ´ç­‰ï¼‰
            setVal("other_month", roundToMan(rentMonth * 0.08));
            
            // ç®¡ç†è²»: è³ƒæ–™ã®8%
            setVal("mgmt_month", roundToMan(rentMonth * 0.08));
        }

        function calcLandFeesAuto(){
            const mode=document.getElementById("landMode").value;
            if(document.getElementById("landAuto").value!=="auto"){ state.landFeesAuto=0; setVal("landFees_auto_net",0); return; }
            const assessedRatio=num("assessedRatio")||0.7;
            let fees=0;
            if(mode==="purchase"){
                const landPrice=num("land_price");
                const brokerage=landPrice>0?(landPrice*0.03+60000):0;
                const assessed=landPrice*assessedRatio;
                fees=brokerage+(assessed*0.015)+(assessed*0.5*0.03)+Math.min(600000,150000+landPrice*0.001)+(300000+Math.max(0,num("gfa_m2"))*120)+(Math.max(0,num("gfa_m2"))*450*(num("siteWorkFactor")||1));
            } else {
                const groundRent=num("ground_rent_month");
                fees=groundRent*(num("deposit_months")+num("key_months")+1)+50000;
            }
            state.landFeesAuto=Math.max(0,fees);
            setVal("landFees_auto_net", Math.round(state.landFeesAuto));
        }

        function calcDevTasksCost(){
            let min=0,max=0;
            state.selectedTasks.forEach(id=>{
                const r=devData.costRanges[id];
                if(r){ min+=Number(r.min||0); max+=Number(r.max||0); }
            });
            state.devTasksCost={min,max};
        }

        function sumTax(net, taxRatePct){ const tax=net*(taxRatePct/100); return {net,tax,gross:net+tax}; }

        function recalcSummary(){
            const taxRate=num("taxRate");
            const mode=document.getElementById("landMode").value;
            const landPurchaseNet=(mode==="purchase")?num("land_price"):0;
            const autoOn=document.getElementById("landAuto").value==="auto";
            const landFeesNet=(autoOn?state.landFeesAuto:0)+num("landFees_net");
            const landPurchase=sumTax(landPurchaseNet, taxRate);
            const landFees=sumTax(landFeesNet, taxRate);
            const buildMin=sumTax(state.build.min, taxRate);
            const buildMax=sumTax(state.build.max, taxRate);
            const otherNet=num("designMgmt_net")+num("registry_net")+num("contingency_net")+num("leasing_net")+num("relocation_net");
            const other=sumTax(otherNet, taxRate);
            const devMin=sumTax(state.devTasksCost.min, taxRate);
            const devMax=sumTax(state.devTasksCost.max, taxRate);
            const totalMin=landPurchase.gross+landFees.gross+buildMin.gross+other.gross+devMin.gross;
            const totalMax=landPurchase.gross+landFees.gross+buildMax.gross+other.gross+devMax.gross;
            setText("totalInv", yenRange(totalMin,totalMax));

            const tbody=document.getElementById("summaryTable");
            tbody.innerHTML="";
            const addRow=(name,a,b=null)=>{
                const tr=document.createElement("tr");
                tr.innerHTML=b?`<td>${name}</td><td class="num">${yenRange(a.net,b.net)}</td><td class="num">${yenRange(a.gross,b.gross)}</td>`:`<td>${name}</td><td class="num">${yenShort(a.net)}</td><td class="num">${yenShort(a.gross)}</td>`;
                tbody.appendChild(tr);
            };
            addRow(mode==="purchase"?"åœŸåœ°ä»•å…¥":"åœŸåœ°ï¼ˆå€Ÿåœ°ï¼‰", landPurchase);
            addRow("åœŸåœ°é–¢é€£è²»", landFees);
            addRow("å»ºç¯‰è²»", buildMin, buildMax);
            addRow("å»ºç¯‰ãã®ä»–", other);
            addRow("é–‹ç™ºä½œæ¥­", devMin, devMax);

            const incomeY=(num("rent_month")+num("other_month"))*12;
            const groundRentYear=num("ground_rent_month")*12;
            const noiY=incomeY-(num("mgmt_month")*12)-groundRentYear-(num("tax_land_year")+num("tax_bldg_year"));
            setText("noi_year", yenShort(noiY));
            const invMid=(totalMin+totalMax)/2;
            setText("gross_yield", (invMid>0?(incomeY/invMid*100):0).toFixed(2)+"%");
            setText("noi_yield", (invMid>0?(noiY/invMid*100):0).toFixed(2)+"%");
            state.summary={totalMin,totalMax,incomeY,noiY,grossYield:invMid>0?(incomeY/invMid*100):0,noiYield:invMid>0?(noiY/invMid*100):0};
        }

        function recalcAll(){
            const plan=document.getElementById("roomPlan").value;
            ["multiRooms","bedsPerRoom","multiAreaPerPerson"].forEach(id=>{ document.getElementById(id).disabled=(plan==="private_only"); });
            syncPrivateArea();
            calcFacilityToAreas();
            calcBuildCost();
            calcLandPriceAuto();   // åœŸåœ°ä¾¡æ ¼ã‚’è‡ªå‹•è¨ˆç®—
            calcOtherCostsAuto();  // å»ºç¯‰è²»ãã®ä»–ã‚’è‡ªå‹•è¨ˆç®—
            calcLandFeesAuto();    // åœŸåœ°è«¸è²»ç”¨ã‚’è¨ˆç®—
            calcDevTasksCost();    // é–‹ç™ºä½œæ¥­è²»ã‚’è¨ˆç®—
            calcIncomeAuto();      // åå…¥ãƒ»è²»ç”¨ã‚’è‡ªå‹•è¨ˆç®—ï¼ˆæŠ•è³‡ç·é¡ã‹ã‚‰é€†ç®—ã™ã‚‹ãŸã‚æœ€å¾Œï¼‰
            recalcSummary();
        }

        function renderFlow(){
            const flow=document.getElementById("flow");
            flow.innerHTML="";
            devData.phases.forEach(p=>{
                const div=document.createElement("div");
                div.className="step";
                div.innerHTML=`<strong>${p.id}.</strong> ${p.name}`;
                flow.appendChild(div);
            });
        }

        function renderPrefSelect(){
            const sel=document.getElementById("pref");
            sel.innerHTML="";
            buildData.prefectures.filter(p=>p.id!=="å…¨å›½å¹³å‡").forEach(p=>{
                const opt=document.createElement("option");
                opt.value=p.id; opt.textContent=p.name;
                sel.appendChild(opt);
            });
            // æ±äº¬23åŒºã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«
            if([...sel.options].some(o=>o.value==="æ±äº¬23åŒº")) sel.value="æ±äº¬23åŒº";
            else if([...sel.options].some(o=>o.value==="æ±äº¬ï¼ˆãã®ä»–ï¼‰")) sel.value="æ±äº¬ï¼ˆãã®ä»–ï¼‰";
            else if(sel.options.length>0) sel.selectedIndex=0;
        }

        function renderTasks(){
            // Aã€œCãƒ•ã‚§ãƒ¼ã‚ºã‚’4ç•ªã«è¡¨ç¤º
            const container=document.getElementById("tasksByPhase");
            container.innerHTML="";
            devData.phases.filter(p => p.id !== "D").forEach(phase=>{
                const h=document.createElement("div");
                h.className="phaseTitle";
                h.innerHTML=`<span class="id">${phase.id}</span> ${phase.name}`;
                container.appendChild(h);
                const group=document.createElement("div");
                group.className="tasks";
                devData.tasks.filter(t=>t.phaseId===phase.id&&t.display).forEach(t=>{
                    const r=devData.costRanges[t.id]||{min:0,max:0,note:""};
                    const row=document.createElement("div");
                    row.className="task";
                    // C-02ï¼ˆä»€å™¨å‚™å“é¸å®šï¼‰ã¯ãƒªãƒ³ã‚¯ä»˜ã
                    if(t.id === "C-02"){
                        row.innerHTML=`<div class="left"><input type="checkbox" data-task="${t.id}" ${state.selectedTasks.has(t.id)?"checked":""}><div><a href="service-equipment.html?residents=${num('residents')}" class="name" style="color:var(--primary);text-decoration:underline;cursor:pointer;">${t.name} â†’</a><div class="desc">${t.description||""}</div></div></div><div class="range"><strong>${r.min===0&&r.max===0?"åˆ¥é€”":yenRange(r.min,r.max)}</strong><span>${r.note||""}</span></div>`;
                    } else {
                        row.innerHTML=`<div class="left"><input type="checkbox" data-task="${t.id}" ${state.selectedTasks.has(t.id)?"checked":""}><div><div class="name">${t.name}</div><div class="desc">${t.description||""}</div></div></div><div class="range"><strong>${r.min===0&&r.max===0?"åˆ¥é€”":yenRange(r.min,r.max)}</strong><span>${r.note||""}</span></div>`;
                    }
                    row.querySelector("input").addEventListener("change",(e)=>{
                        if(e.target.checked) state.selectedTasks.add(t.id); else state.selectedTasks.delete(t.id);
                        recalcAll();
                    });
                    group.appendChild(row);
                });
                container.appendChild(group);
            });
            
            // Dãƒ•ã‚§ãƒ¼ã‚ºï¼ˆé–‹æ¥­æº–å‚™ï¼‰ã‚’5ç•ªã«è¡¨ç¤º
            const containerD=document.getElementById("tasksByPhaseD");
            if(containerD){
                containerD.innerHTML="";
                const groupD=document.createElement("div");
                groupD.className="tasks";
                devData.tasks.filter(t=>t.phaseId==="D"&&t.display).forEach(t=>{
                    const r=devData.costRanges[t.id]||{min:0,max:0,note:""};
                    const row=document.createElement("div");
                    row.className="task";
                    row.innerHTML=`<div class="left"><input type="checkbox" data-task="${t.id}" ${state.selectedTasks.has(t.id)?"checked":""}><div><div class="name">${t.name}</div><div class="desc">${t.description||""}</div></div></div><div class="range"><strong>${r.min===0&&r.max===0?"åˆ¥é€”":yenRange(r.min,r.max)}</strong><span>${r.note||""}</span></div>`;
                    row.querySelector("input").addEventListener("change",(e)=>{
                        if(e.target.checked) state.selectedTasks.add(t.id); else state.selectedTasks.delete(t.id);
                        recalcAll();
                    });
                    groupD.appendChild(row);
                });
                containerD.appendChild(groupD);
            }
        }

        // ä»€å™¨å‚™å“ã¯åˆ¥ãƒšãƒ¼ã‚¸ï¼ˆservice-equipment.htmlï¼‰ã«ç§»å‹•
        function renderEquipment(){ /* no-op */ }
        function calcEquipmentTotal(){ return 0; }

        function bindInputs(){
            const ids=["facilityType","residents","roomPlan","privateAreaPreset","privateArea","familyRooms","familyRoomArea","commonFactor","buildingType","rentable_ratio","useFactor","indexFactor","multiRooms","bedsPerRoom","multiAreaPerPerson","pref","structure","floors","gfa_m2","landMode","taxRate","landAuto","assessedRatio","land_price","ground_rent_month","siteWorkFactor","deposit_months","key_months","landFees_net","designMgmt_net","registry_net","contingency_net","leasing_net","relocation_net","rent_month","other_month","mgmt_month","tax_land_year","tax_bldg_year"];
            ids.forEach(id=>{
                const el=document.getElementById(id); if(!el) return;
                el.addEventListener("input", ()=>{ if(id==="buildingType") syncBuildingTypeToRatio(); if(id==="facilityType") applyFacilityPreset(); if(id==="floors") updateFloorHint(); recalcAll(); });
                el.addEventListener("change", ()=>{ if(id==="buildingType") syncBuildingTypeToRatio(); if(id==="facilityType") applyFacilityPreset(); if(id==="floors") updateFloorHint(); recalcAll(); });
            });
            document.getElementById("btnCalc").addEventListener("click", ()=>{ recalcAll(); alert("è¨ˆç®—ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ"); });
            document.getElementById("btnSave").addEventListener("click", ()=>{ localStorage.setItem("devSimulation", JSON.stringify(exportState())); alert("ä¿å­˜ã—ã¾ã—ãŸ"); });
            document.getElementById("btnToMember").addEventListener("click", ()=>{ localStorage.setItem("devSimulation", JSON.stringify(exportState())); location.href="estimate-development.html"; });
        }

        // éšæ•°ã«å¿œã˜ãŸãƒ’ãƒ³ãƒˆè¡¨ç¤º
        function updateFloorHint(){
            const floors = parseInt(document.getElementById("floors").value) || 2;
            const hint = document.getElementById("floorHint");
            if(!hint) return;
            
            if(floors === 1){
                hint.innerHTML = "ğŸ’¡ å¹³å±‹ï¼šæ§‹é€ ãƒ»è¨­å‚™ãŒã‚·ãƒ³ãƒ—ãƒ«ã§æœ€ã‚‚ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒè‰¯ã„ã€‚EVä¸è¦ã€‚";
                hint.style.color = "#10b981";
            } else if(floors <= 2){
                hint.innerHTML = "ğŸ’¡ 2éšå»ºã¦åŸºæº–ã€‚æœ¨é€ ãƒ»Sé€ ã§å¯¾å¿œå¯èƒ½ã€‚EV1åŸºç¨‹åº¦ã€‚";
                hint.style.color = "";
            } else if(floors <= 5){
                hint.innerHTML = "ğŸ’¡ 3ã€œ5éšï¼šEVå¿…é ˆã€‚èº¯ä½“ã‚³ã‚¹ãƒˆä¸Šæ˜‡ã€‚Sé€ /RCé€ æ¨å¥¨ã€‚";
                hint.style.color = "#f59e0b";
            } else {
                hint.innerHTML = "âš ï¸ 6éšä»¥ä¸Šï¼šã€æ§‹é€ ã®å£ã€‘æŸ±ãƒ»æ¢ãƒ»åŸºç¤ãŒå¤§å¹…å¢—ã€‚ã€æ¶ˆé˜²ã®å£ã€‘ã‚¹ãƒ—ãƒªãƒ³ã‚¯ãƒ©ãƒ¼ãƒ»æ’ç…™ãƒ»éå¸¸ç”¨ç™ºé›»æ©ŸãŒå¿…é ˆã€‚ã€EVã®å£ã€‘éå¸¸ç”¨EVè¿½åŠ ã€‚è²»ç”¨ãŒå¤§ããè·³ã­ã¾ã™ã€‚";
                hint.style.color = "#ef4444";
            }
        }

        function exportState(){
            return {
                version:"devSim_v6",
                savedAt:new Date().toISOString(),
                facility:{ facilityType:document.getElementById("facilityType").value, residents:num("residents"), roomPlan:document.getElementById("roomPlan").value, privateArea:num("privateArea"), familyRooms:num("familyRooms"), familyRoomArea:num("familyRoomArea"), commonFactor:num("commonFactor"), multiRooms:num("multiRooms"), bedsPerRoom:Number(document.getElementById("bedsPerRoom").value||4), multiAreaPerPerson:Number(document.getElementById("multiAreaPerPerson").value||8), buildingType:document.getElementById("buildingType").value, rentableRatio:num("rentable_ratio") },
                inputs:{ pref:document.getElementById("pref").value, structure:document.getElementById("structure").value, floors:parseInt(document.getElementById("floors").value)||2, gfa_m2:num("gfa_m2"), useFactor:num("useFactor"), indexFactor:num("indexFactor"), taxRate:num("taxRate"), land:{ mode:document.getElementById("landMode").value, auto:document.getElementById("landAuto").value, assessedRatio:num("assessedRatio"), land_price:num("land_price"), ground_rent_month:num("ground_rent_month"), siteWorkFactor:num("siteWorkFactor"), deposit_months:num("deposit_months"), key_months:num("key_months"), landFees_manual_net:num("landFees_net"), landFees_auto_net:state.landFeesAuto }},
                selectedTasks:Array.from(state.selectedTasks),
                computed:{build:state.build, devTasksCost:state.devTasksCost, summary:state.summary}
            };
        }

        (function init(){
            // ã™ã¹ã¦ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼ˆå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ï¼‰
            devData = DEV_DATA;
            buildData = BUILD_DATA;
            console.log("Data loaded:", buildData.prefectures.length, "prefectures");
            renderFlow();
            renderPrefSelect();
            applyFacilityPreset();
            syncBuildingTypeToRatio();
            updateFloorHint();
            renderTasks();
            bindInputs();
            recalcAll();
            console.log("Init complete");
        })();
    </script>
</body>
</html>
